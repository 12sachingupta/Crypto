(globalThis.webpackChunk_wigwam_app=globalThis.webpackChunk_wigwam_app||[]).push([[408],{25343:(t,e,n)=>{"use strict";var a=n(62714),r=n(43913);a.Z.defaults.adapter=r.Z;n(88535);var s=n(94500),o=n(62375);var i=n(69147),c=n(87380),d=n(90406),u=n(93150),l=n.n(u);var p=n(98964),h=n(43624),y=n(53975),m=n(42592),g=n(48481);const w=new Map;class f{name;ports;messageHandlers;connectionHandlers;get portsCount(){return this.ports.size}constructor(t){this.name=t,this.ports=new Map,this.messageHandlers=new Set,this.connectionHandlers=new Set,l().runtime.onConnect.addListener(this.handleConnect.bind(this)),this.handleMessage=this.handleMessage.bind(this)}onMessage(t){return this.addMessageHandler(t),()=>this.removeMessageHandler(t)}onConnection(t){return this.connectionHandlers.add(t),()=>this.connectionHandlers.delete(t)}isConnected(t){return this.ports.has((0,g.tF)(t))}broadcast(t){const e={type:m.$.OneWay,data:t};for(const t of this.ports.values())t.postMessage((0,g.Z$)(e))}notify(t,e){this.isConnected(t)&&t.postMessage((0,g.Z$)({type:m.$.OneWay,data:e}))}handleConnect(t){w.set((0,g.tF)(t),t),t.name.startsWith(this.name)&&(this.addPort(t),(0,y.s)(this.connectionHandlers,(e=>e("connect",t))),t.onDisconnect.addListener((()=>{w.delete((0,g.tF)(t)),this.removePort(t),(0,y.s)(this.connectionHandlers,(e=>e("disconnect",t)))})))}handleMessage(t,e){if(e.sender?.id===l().runtime.id&&g.oK.includes(t?.type)){const n=new v((0,g.tF)(e),t);(0,y.s)(this.messageHandlers,(t=>t(n)))}}addPort(t){t.onMessage.addListener(this.handleMessage),this.ports.set((0,g.tF)(t),t)}removePort(t){t.onMessage.removeListener(this.handleMessage),this.ports.delete((0,g.tF)(t))}addMessageHandler(t){this.messageHandlers.add(t)}removeMessageHandler(t){this.messageHandlers.delete(t)}}class v{portId;msg;constructor(t,e){this.portId=t,this.msg=e}get port(){return w.get(this.portId)}get request(){return this.msg.type===m.$.Req}get data(){return this.msg.data}reply(t){this.send(this.msg.type===m.$.Req?{type:m.$.Res,reqId:this.msg.reqId,data:t}:{type:m.$.OneWay,data:t})}replyError(t){this.msg.type===m.$.Req&&this.send({type:m.$.Err,reqId:this.msg.reqId,data:(0,g.Xy)(t)})}send(t){this.port?.postMessage((0,g.Z$)(t))}}var S=n(67135),b=n(85350),A=n(98116);const k=(0,A.yM)(),U=(0,A.yM)(),T=(0,A.yM)(),_=(0,A.yM)(),x=(0,A.yM)(),P=(0,A.yM)(),C=(0,A.yM)(),I=(0,A.yM)(),D=(0,A.yM)(),R=(0,A.TS)([C,I,D]),E=(0,A.yM)(),M=(0,A.yM)();var F=n(79826),N=n(38558);const K=(0,A.MT)(b.PR.Idle).on(k,((t,e)=>e?b.PR.Locked:b.PR.Welcome)).on(U,(()=>b.PR.Unlocked)).on(T,(t=>t===b.PR.Unlocked?b.PR.Locked:t)),B=(0,A.MT)(!1).on(U,((t,{hasSeedPhrase:e})=>e)).on(_,(()=>!0)).on(T,(()=>!1)),L=(0,A.$e)([K,B]),Z=(0,A.MT)({prev:null,current:[]}).on(U,((t,{accounts:e})=>({prev:null,current:e}))).on(x,(({current:t},e)=>({prev:t,current:e}))).on(T,(()=>({prev:null,current:[]}))),H=Z.map((({current:t})=>t)),j=(0,A.MT)(null).on(U,((t,{vault:e})=>e)).on(T,(t=>(t?.cleanup(),null))),W=(0,A.MT)([]).on(E,((t,e)=>[...t,e])).on(M,((t,e)=>{const n=t.indexOf(e);if(n>-1){const e=Array.from(t);return e.splice(n,1),e}return t})).map((t=>Array.from(new Set(t)))),Y=(0,A.MT)([]).on(U,((t,{approvals:e})=>e??[])).on(C,((t,e)=>{if(e.type===b.T8.Connection){const n=(0,N.o)(e.source);let a=0;for(const r of t){if(r.type===b.T8.Connection&&(0,N.o)(r.source)===n)return t.filter(((t,n)=>n===a?e:t));a++}return[e,...t]}if(e.type===b.T8.Transaction&&e.source.replaceTx){const n=e.source.replaceTx.prevActivityId,a=t.filter((t=>t.source.replaceTx?.prevActivityId!==n));if(a.length!==t.length)return[e,...a]}return[...t,e]})).on(I,((t,e)=>t.filter((t=>t.id!==e)))).on(D,((t,e)=>{let n,a;if(e){n=[],a=[];for(const r of t)e.includes(r.id)?n.push(r):a.push(r)}else n=t,a=[];return V(n),a})).on(T,(t=>(V(t),[]))),O=H.map((t=>t.map((t=>t.address))));function V(t){for(const{rpcCtx:e}of t)try{e?.reply({error:F.Sy.provider.userRejectedRequest()})}catch{}}var G=n(79215);const $=new(n(54078).i)("session");var q=n(90603);const z="gtPVdW1t1Tl5BaC5dOCNA";async function J(t,e){try{const n=(0,q.Iv)(32),a=await tt(n),r=(0,q.Iv)(16),s=new Uint8Array(await crypto.subtle.encrypt({name:"AES-GCM",iv:r},a,(0,q.iY)(JSON.stringify(e)))),o=new Uint8Array([...n,...r,...s]);(0,q.Bc)(n),(0,q.Bc)(r),(0,q.Bc)(s);const i=(0,q.J2)(o);(0,q.Bc)(o),await $.put(t,i)}catch(t){}}async function X(t){try{const e=await $.fetchForce(t);if(!e)return null;const n=(0,q.K9)(e);let a=0;const r=t=>n.slice(a,t&&(a+=t)),s=r(32),o=r(16),i=r();(0,q.Bc)(n);const c=await tt(s);(0,q.Bc)(s);const d=await crypto.subtle.decrypt({name:"AES-GCM",iv:o},c,i);(0,q.Bc)(o),(0,q.Bc)(i);const u=JSON.parse((0,q.Md)(new Uint8Array(d)));return(0,q.Bc)(d),u}catch(t){return null}}async function Q(t){await $.remove(t).catch(console.error)}async function tt(t){const e=await async function(){const t=await(0,i.v4)(),e=[z,t].join("_");return crypto.subtle.digest("SHA-256",(0,q.iY)(e))}(),n=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits","deriveKey"]);(0,q.Bc)(e);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e4,hash:"SHA-512"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}var et=n(45642),nt=n(16788);class at{msgCtx;static from({portId:t,msg:e}){const n=new v(t,e);return new at(n)}serialize(){return{portId:this.msgCtx.portId,msg:this.msgCtx.msg}}constructor(t){this.msgCtx=t}reply(t){if("error"in t){const{message:e,code:n,data:a}=t.error;t={error:{message:e,code:n,data:a}}}if(e=this.msgCtx,e.port?.name.startsWith(b.Kx.Wallet))this.msgCtx.reply({type:this.msgCtx.data.type,response:t});else{const{id:e,jsonrpc:n}=this.msgCtx.data;this.msgCtx.reply({id:e,jsonrpc:n,...t})}var e}}var rt=n(39181),st=n(455),ot=n(71205),it=n(5556),ct=n(51091),dt=n(48764),ut=n(30845);const{base64ToBytes:lt,bytesToBase64:pt,zeroBuffer:ht}=s.ByteUtils;function yt(t,e,n){const a=new s.Kdbx;return a.credentials=t,a.header=s.KdbxHeader.create(),a.meta=s.KdbxMeta.create(),a.meta._name=e,a.meta.recycleBinEnabled=!1,a.createDefaultGroup(),function(t,e){const n=t.header.kdfParameters;if(!n)throw new Error("Cannot set KDF on this version");const{ValueType:a}=s.VarDictionary,{KdfId:r}=s.Consts;if("Aes"===e.type)t.setKdf(r.Aes),n.set("R",a.UInt32,e.rounds);else{const{type:o,memory:i,iterations:c,parallelism:d}=e;t.setKdf("Argon2id"===o?r.Argon2id:r.Argon2d),n.set("M",a.UInt64,s.Int64.from(i)),n.set("I",a.UInt64,s.Int64.from(c)),n.set("P",a.UInt32,d)}}(a,n),a}function mt(t,e=s.KdbxUuid.random()){const n=new s.KdbxGroup;return n.uuid=St(e),n.parentGroup=t,t.groups.push(n),n}function gt(t,e){for(const[n,a]of Object.entries(e))t.fields.set(n,a)}function wt(t,e={}){const n={};for(const[e,a]of t.fields.entries())n[e]=a instanceof s.ProtectedValue?vt(a):a;return e.uuid&&(n.uuid=t.uuid.toString()),n}function ft(t){const e=lt(t),n=e.byteLength/2,a=e.slice(0,n),r=e.slice(n,e.byteLength);ht(e);const o=new s.ProtectedValue(a,r);ht(a),ht(r);const i=s.CryptoEngine.random(n);return o.setSalt(i),ht(i),o}function vt(t){const e=t.clone(),n=s.CryptoEngine.random(e.byteLength);e.setSalt(n);const a=new Uint8Array([...e.value,...e.salt]),r=pt(a);return ht(a),r}function St(t){return t instanceof s.KdbxUuid?t:new s.KdbxUuid(t)}const bt={type:"Argon2id",memory:15728640,iterations:2,parallelism:1};var At=n(94316);function kt(t){const e={passwordHash:t,timestamp:Date.now()};return J(b.bE,e)}const{bytesToBase64:Ut,base64ToBytes:Tt,zeroBuffer:_t,arrayToBuffer:xt,arrayBufferEquals:Pt}=s.ByteUtils;var Ct,It;!function(t){t.KeyFile="vault_keyfile",t.Data="vault_data"}(Ct||(Ct={})),function(t){t.Accounts="LC1q3/r/GuXIIBFvZVIdjA==",t.SeedPhrases="JCwiJUMhmarO4ZvNS99/WA==",t.AccountKeys="aaovObw95bFaxfkNRBpM6w=="}(It||(It={}));class Dt{kdbx;static ensureNotBlocked;static onPasswordUsage;static isExist(){return S.t.isStored("vault_keyfile")}static async setup(t,e,n){return(0,At.AQ)((0,G.t)("failedToSetupWallet"),(async a=>{if((0,et.h)(t.length>0&&e.length>0),await Dt.isExist())throw a();n&&(0,At.bk)(n),e.forEach(At.yq);const r=await s.Credentials.createRandomKeyFile(),o=new s.Credentials(null,r);o.passwordHash=ft(t);const i=yt(o,"Vault",bt),c=i.getDefaultGroup();for(const t of Object.values(It))mt(c,t);const d=new Dt(i);n&&d.addSeedPhraseForce(n),d.addAccountsForce(e);const u=await i.save(),l=Ut(r);_t(r);const p=Ut(u);return _t(u),await S.t.putMany([["vault_keyfile",l],["vault_data",p]]),await kt(t),d}))}static async unlock(t){return(0,At.AQ)((0,G.t)("failedToUnlockWallet"),(async e=>{await(Dt.ensureNotBlocked?.());const[n,a]=await S.t.fetchMany(["vault_keyfile","vault_data"]);if(!n||!a)throw e();const r=Tt(n),o=xt(Tt(a)),i=await(0,At.AQ)((0,G.t)("invalidPassword"),(async()=>{let e=!0;try{const e=new s.Credentials(null,r);return e.passwordHash=ft(t),await s.Kdbx.load(o,e)}catch(t){throw e=!1,t}finally{_t(r),await(Dt.onPasswordUsage?.(e))}}));return await kt(t),new Dt(i)}))}constructor(t){this.kdbx=t}cleanup(){return this.kdbx.cleanup({historyRules:!0,customIcons:!0,binaries:!0}),Q(b.bE)}async changePassword(t,e){return await this.verify(t),(0,At.AQ)((0,G.t)("failedToChangePassword"),(async()=>{this.kdbx.credentials.passwordHash=ft(e);const t=await s.Credentials.createRandomKeyFile();await this.kdbx.credentials.setKeyFile(t);const n=Ut(t);_t(t);const a=await this.kdbx.save(),r=Ut(a);_t(a),await S.t.putMany([["vault_keyfile",n],["vault_data",r]]),await kt(e)}))}isSeedPhraseExists(){return this.getGroup("JCwiJUMhmarO4ZvNS99/WA==").entries[0]instanceof s.KdbxEntry}async getSeedPhrase(t){return await this.verify(t),(0,At.AQ)((0,G.t)("failedToFetchSeedPhrase"),(()=>this.getSeedPhraseForce()))}getNeuterExtendedKey(t){return(0,At.AQ)((0,G.t)("failedToFetchPublicKey"),(()=>{(0,At.pw)(t);const e=this.getSeedPhraseForce(),n=(0,At.W1)((0,At.d6)(e),t);return vt(s.ProtectedValue.fromString(n))}))}getAccounts(){let t=this.getGroup("LC1q3/r/GuXIIBFvZVIdjA==").entries.map((t=>wt(t,{uuid:!0})));return t=t.filter((t=>t.source!==b.iL.Address)),t}async addAccounts(t,e){return(0,At.AQ)((0,G.t)("failedToAddWallets"),(async()=>{e&&(0,At.bk)(e),t.forEach(At.yq),e&&this.addSeedPhraseForce(e),this.addAccountsForce(t),await this.saveData()}))}async deleteAccounts(t,e){return await this.verify(t),(0,At.AQ)((0,G.t)("failedToDeleteWallets"),(async()=>{if(0===e.length)return;const t=this.getGroup("LC1q3/r/GuXIIBFvZVIdjA==");if(e.length>=t.entries.length)throw new Error("Cannot delete all accounts");for(const n of e){const e=this.getEntry(t,n);e&&this.kdbx.remove(e)}await this.saveData()}))}updateAccountName(t,e){return(0,At.AQ)((0,G.t)("failedToUpdateWalletName"),(async()=>{(0,et.h)(e.length>0);const n=this.getGroup("LC1q3/r/GuXIIBFvZVIdjA==");let a;for(const r of n.entries){if(r.fields.get("name")===e)throw new At.BF((0,G.t)("walletNameAlreadyExists"));r.uuid.equals(t)&&(a=r)}(0,et.h)(a,"Account not found"),a.fields.set("name",e),await this.saveData()}))}getPublicKey(t){return(0,At.AQ)((0,G.t)("failedToFetchPublicKey"),(()=>vt(this.getKeyForce(t,"publicKey"))))}sign(t,e){return(0,At.AQ)((0,G.t)("failedToSign"),(async()=>{const n=this.getKeyForce(t,"privateKey").getText();return new rt.E(n).sign(e)}))}signMessage(t,e,n){return(0,At.AQ)((0,G.t)("failedToSign"),(()=>{const a=this.getKeyForce(t,"privateKey"),r=dt.Buffer.from(st.Pw(a.getText()));try{switch(e){case b.xd.PersonalSign:return(0,ct.personalSign)({data:n,privateKey:r});case b.xd.SignTypedDataV1:return(0,ct.signTypedData)({version:ct.SignTypedDataVersion.V1,data:n,privateKey:r});case b.xd.SignTypedDataV3:return(0,ct.signTypedData)({version:ct.SignTypedDataVersion.V3,data:JSON.parse(n),privateKey:r});case b.xd.SignTypedDataV4:return(0,ct.signTypedData)({version:ct.SignTypedDataVersion.V4,data:JSON.parse(n),privateKey:r});default:throw null}}finally{_t(r)}}))}async getPrivateKey(t,e){return await this.verify(t),(0,At.AQ)((0,G.t)("failedToFetchPrivateKey"),(()=>vt(this.getKeyForce(e,"privateKey"))))}addAccountsForce(t){const e=(0,ut.Z)((()=>{const t=this.getSeedPhraseForce();return(0,At.d6)(t)})),n=t.map((t=>{const{source:n,name:a}=t,r={uuid:s.KdbxUuid.random().toString(),name:a};switch(n){case b.iL.SeedPhrase:{const{derivationPath:a}=t,o=e(),{address:i,privateKey:c,publicKey:d}=o.derivePath(a);return{account:{...r,source:n,address:i,derivationPath:a},keys:{privateKey:s.ProtectedValue.fromString(c),publicKey:s.ProtectedValue.fromString(d)}}}case b.iL.PrivateKey:{const e=(0,At.Xn)(ft(t.privateKey).getText()),a=rt.E.computePublicKey(e,!0),o=ot.d(a);return{account:{...r,source:n,address:o},keys:{privateKey:s.ProtectedValue.fromString(e),publicKey:s.ProtectedValue.fromString(a)}}}case b.iL.OpenLogin:{const e=(0,At.Xn)(ft(t.privateKey).getText()),a=rt.E.computePublicKey(e,!0),o=ot.d(a),{social:i,socialName:c,socialEmail:d}=t;return{account:{...r,source:n,address:o,social:i,socialName:c,socialEmail:d},keys:{privateKey:s.ProtectedValue.fromString(e),publicKey:s.ProtectedValue.fromString(a)}}}case b.iL.Ledger:{const e=t.derivationPath,a=rt.E.computePublicKey((0,At.Xn)(ft(t.publicKey).getText()),!0),o=ot.d(a);return{account:{...r,source:n,address:o,derivationPath:e},keys:{publicKey:s.ProtectedValue.fromString(a)}}}case b.iL.Address:{let{address:e}=t;e=it.K(e);return{account:{...r,source:n,address:e},keys:{}}}default:throw null}}));e.clear();const a=[this.getAccounts(),n.map((({account:t})=>t))].flat();(0,At.Nu)(a);for(const{account:t,keys:e}of n){const{uuid:n,...a}=t;gt(this.createEntry("LC1q3/r/GuXIIBFvZVIdjA==",n),a);gt(this.createEntry("aaovObw95bFaxfkNRBpM6w==",n),e)}}addSeedPhraseForce(t){if(this.isSeedPhraseExists())throw new At.BF((0,G.t)("seedPhraseAlreadyExists"));gt(this.createEntry("JCwiJUMhmarO4ZvNS99/WA=="),{phrase:ft(t.phrase),lang:t.lang})}getKeyForce(t,e){const n=this.getEntry("aaovObw95bFaxfkNRBpM6w==",t);(0,et.h)(n,"Account not found");const a=n.fields.get(e);return(0,et.h)(a instanceof s.ProtectedValue,"Field not found"),a}getSeedPhraseForce(){return wt(this.getSeedPhraseEntry())}getSeedPhraseEntry(){if(this.isSeedPhraseExists())return this.getGroup("JCwiJUMhmarO4ZvNS99/WA==").entries[0];throw new At.BF((0,G.t)("seedPhraseNotEstablished"))}async verify(t){return(0,At.AQ)((0,G.t)("invalidPassword"),(async e=>{await(Dt.ensureNotBlocked?.());const n=ft(t).getBinary(),a=xt(this.kdbx.credentials.passwordHash.getBinary());try{const t=Pt(n,a);if(await(Dt.onPasswordUsage?.(t)),!t)throw e()}finally{_t(n),_t(a)}}))}async saveData(){const t=await this.kdbx.save(),e=Ut(t);_t(t),await S.t.put("vault_data",e)}createEntry(t,e=s.KdbxUuid.random()){const n=this.getGroup(t),a=new s.KdbxEntry;return a.uuid=St(e),a.parentGroup=n,a.autoType.enabled=!1,n.entries.push(a),a}getEntry(t,e){const n=t instanceof s.KdbxGroup?t:this.getGroup(t);for(const t of n.entries)if(t.uuid.equals(e))return t;return null}getGroup(t){const e=this.kdbx.getDefaultGroup();for(const n of e.groups)if(n.uuid.equals(t))return n;throw new Error("Group not found")}}const Rt=(0,h.j)();async function Et(){K.getState()===b.PR.Idle&&await Rt((async()=>{if(K.getState()!==b.PR.Idle)return;const[t,e]=await Promise.all([X(b.bE),X(b.MV)]),n=e?.map((t=>({...t,rpcCtx:at.from(t.rpcCtx)})));if(t){const{passwordHash:e,timestamp:a}=t,r=await(0,nt.s)();if(0===r||Date.now()-a<r)try{return void await async function(t,e){const n=await Dt.unlock(t),a=n.getAccounts(),r=n.isSeedPhraseExists();U({vault:n,accounts:a,hasSeedPhrase:r,approvals:e})}(e,n)}catch{}await Q(b.bE)}const a=await Dt.isExist();k(a)}))}async function Mt(t,e){const n=K.getState();return(0,et.h)(Array.isArray(t)?t.includes(n):n===t,(0,G.t)("notAllowed")),e()}async function Ft(t){const e=j.getState();return(0,et.h)(e instanceof Dt,(0,G.t)("walletLocked")),t(e)}function Nt(){return K.getState()===b.PR.Unlocked}var Kt=n(24471),Bt=n(93425),Lt=n(48747),Zt=n(87618);const Ht=(0,Lt.ZP)(((t,e)=>new jt(t,e)));class jt extends Kt.r6{getNetwork=(0,ut.Z)(super.getNetwork.bind(this));getChainId=()=>this.getNetwork().then((({chainId:t})=>t));constructor(t,e){super(t,e,{staticNetwork:Bt.Z.from(e)})}}function Wt(t){return`0x${t.toString(16)}`}const Yt={code:-32603,message:"Internal JSON-RPC error."};async function Ot(t,e,n){return async function(t,e,n,a){const r=Ht(e,t),s=async()=>{switch(n){case"eth_chainId":return r.getChainId().then(Wt);case"net_version":return r.getChainId();case"eth_blockNumber":return r.getBlockNumber().then(Wt);default:return r.send(n,a)}};try{return{result:await s()}}catch(t){const e=t.info?.error??t.error;if(e){const{message:t,code:n,data:a}=e;return{error:{message:t,code:n,data:a}}}return{error:Yt}}}(t,await(0,Zt.RM)(t),e,n)}const Vt=(0,Lt.ZP)((t=>new Gt(t)));class Gt extends Kt.vH{chainId;constructor(t){super(t,{staticNetwork:Bt.Z.from(t)}),this.chainId=t,this.getNetwork=(0,ut.Z)(super.getNetwork.bind(this))}getNetwork;async send(t,e){return function(t){if("error"in t){const e=new Error(t.error.message);throw e.code=t.error.code,e.data=t.error.data,e}return t.result}(await Ot(this.chainId,t,e))}async _send(t){const e=Array.isArray(t)?t:[t];return await Promise.all(e.map((async({jsonrpc:t,id:e,method:n,params:a})=>({jsonrpc:t,id:e,...await Ot(this.chainId,n,a)}))))}}var $t=n(53416),qt=n(97884),zt=n(79554);function Jt(t){if("page"===t.type&&!t.permission)throw F.Sy.provider.unauthorized()}function Xt(t){if(K.getState()===b.PR.Welcome)throw t?.openIfNotSetuped&&(0,c.Ch)(),F.Sy.provider.userRejectedRequest()}function Qt(t,e){if(!e||!zt.UJ(e))throw F.Sy.rpc.invalidParams();if("page"===t.type&&!t.permission?.accountAddresses.includes(e))throw F.Sy.provider.unauthorized();if(!O.getState().includes(e))throw F.Sy.rpc.resourceUnavailable()}const te=t=>(0,At.Hy)(t).then((()=>!0)).catch((()=>{throw F.Sy.rpc.resourceNotFound("Network not found")}));const ee=t=>(0,qt.define)("stringHex",(e=>st.A7(e,t))),ne=()=>(0,qt.define)("stringOrNumber",(t=>"string"===typeof t||"number"===typeof t)),ae=()=>(0,qt.define)("address",(t=>zt.UJ(t))),re=(0,qt.object)({from:ae(),to:(0,qt.optional)(ae()),nonce:(0,qt.optional)(ne()),gasPrice:(0,qt.optional)(ee()),gasLimit:(0,qt.optional)(ee()),value:(0,qt.optional)(ee()),data:(0,qt.optional)(ee()),chainId:(0,qt.optional)(ne()),type:(0,qt.optional)(ne()),accessList:(0,qt.optional)((0,qt.array)((0,qt.object)({address:ae(),storageKeys:(0,qt.array)(ee())}))),maxPriorityFeePerGas:(0,qt.optional)(ee()),maxFeePerGas:(0,qt.optional)(ee())}),se=(0,qt.object)({chainId:ee(),chainName:(0,qt.string)(),nativeCurrency:(0,qt.object)({name:(0,qt.string)(),symbol:(0,qt.string)(),decimals:(0,qt.number)()}),rpcUrls:(0,qt.nonempty)((0,qt.array)((0,qt.string)())),blockExplorerUrls:(0,qt.optional)((0,qt.nullable)((0,qt.array)((0,qt.string)()))),iconUrls:(0,qt.optional)((0,qt.nullable)((0,qt.array)((0,qt.string)())))});async function oe(t,e,n,a){Jt(e),await te(n);let r,s=a?.[0];try{if(s=function(t){t={...t};for(const e of Object.keys(t))t[e]||delete t[e];return t}(s),r=it.K(s.from),"gas"in s){const{gas:t,...e}=s;s={...e,gasLimit:t}}(0,qt.assert)(s,re),(0,et.h)(s.to||s.data)}catch(t){throw F.Sy.rpc.invalidParams()}Qt(e,r),C({id:(0,$t.x0)(),type:b.T8.Transaction,source:e,timeAt:Date.now(),chainId:n,accountAddress:r,txParams:s,rpcCtx:t})}var ie=n(40565);const{isAddress:ce,getAddress:de,isHexString:ue,toUtf8Bytes:le,hexlify:pe}=ie;function he(t){try{return"https:"===new URL(t).protocol}catch(t){return!1}}async function ye(t,e,n,a){let r;Xt();try{r=parseInt(a[0].chainId),(0,et.h)(!isNaN(r))}catch{throw F.Sy.rpc.invalidParams()}try{await te(r),e="switch"}catch{if("switch"===e){const t=F.Sy.rpc.resourceNotFound("Network not been added");throw t.code=4902,t}}(0,et.h)("page"===n.type);const s=(0,N.o)(n);if("switch"===e)await d.xJ(s,r),t.reply({result:null});else{const e=a[0];!function(t){try{t.rpcUrls=t.rpcUrls.filter(he),t.blockExplorerUrls=t.blockExplorerUrls?.filter(he),t.iconUrls=t.iconUrls?.filter(he)}catch(t){}}(e),await async function(t){try{(0,qt.assert)(t,se)}catch(t){throw F.Sy.rpc.invalidParams("Network params invalid")}}(e),C({id:(0,$t.x0)(),type:b.T8.AddNetwork,source:n,timeAt:Date.now(),chainId:r,networkParams:e,rpcCtx:t})}}async function me(t,e,n,a,r){const s=new at(t),o=async()=>{if("page"===e.type){if(!Nt())return;const t=(0,N.o)(e),a=await d.mk.get(t);a&&(e={...e,permission:a},n=a.chainId)}};try{switch(a){case b.WU.wallet_getPermissions:return ge(e),await async function(t,e){const n=(0,N.o)(e),a=await d.mk.get(n),r=(a?[a]:[]).map(N.H);t.reply({result:r})}(s,e);case b.WU.wallet_requestPermissions:case b.WU.eth_requestAccounts:{ge(e);const t=a===b.WU.eth_requestAccounts;return await async function(t,e,n,a){Xt({openIfNotSetuped:!0}),C({id:(0,$t.x0)(),type:b.T8.Connection,source:e,timeAt:Date.now(),returnSelectedAccount:a,rpcCtx:t})}(s,e,0,t)}case b.WU.eth_sendTransaction:return await o(),await oe(s,e,n,r);case b.WU.personal_sign:case b.WU.eth_signTypedData:case b.WU.eth_signTypedData_v1:case b.WU.eth_signTypedData_v2:case b.WU.eth_signTypedData_v3:case b.WU.eth_signTypedData_v4:{await o();const t=function(t){switch(t){case b.WU.eth_sign:return b.xd.EthSign;case b.WU.personal_sign:return b.xd.PersonalSign;case b.WU.eth_signTypedData:case b.WU.eth_signTypedData_v1:return b.xd.SignTypedDataV1;case b.WU.eth_signTypedData_v3:return b.xd.SignTypedDataV3;case b.WU.eth_signTypedData_v4:return b.xd.SignTypedDataV4;default:throw F.Sy.provider.unsupportedMethod()}}(a);return await async function(t,e,n,a){let r,s;switch(Jt(e),n){case b.xd.EthSign:throw F.Sy.provider.unsupportedMethod();case b.xd.PersonalSign:r=a[1],s=a[0],ce(r)||(r=a[0],s=a[1]);break;case b.xd.SignTypedDataV1:r=a[1],s=a[0];break;case b.xd.SignTypedDataV3:case b.xd.SignTypedDataV4:r=a[0],s=a[1];break;default:throw new Error("Unhandled Signing standard")}try{switch(r=de(r),n){case b.xd.PersonalSign:s=ue(s)?s:pe(le(s));break;case b.xd.SignTypedDataV1:(0,et.h)(Array.isArray(s)&&s.every((t=>"string"===typeof t.type&&"string"===typeof t.name&&"string"===typeof t.value)));break;case b.xd.SignTypedDataV3:case b.xd.SignTypedDataV4:(0,et.h)(s&&"string"===typeof s&&"object"===typeof JSON.parse(s));break;default:throw new Error("Unhandled Signing standard")}}catch{throw F.Sy.rpc.invalidParams()}Qt(e,r),C({id:(0,$t.x0)(),type:b.T8.Signing,source:e,timeAt:Date.now(),accountAddress:r,standard:n,message:s,rpcCtx:t})}(s,e,t,r)}case b.WU.personal_ecRecover:return await o(),await async function(t,e,n){let a,r,s;Jt(e);try{[a,r]=n,(0,et.h)(ue(a)&&ue(r)),s=(0,ct.recoverPersonalSignature)({data:a,signature:r})}catch{throw F.Sy.rpc.invalidParams()}t.reply({result:de(s)})}(s,e,r);case b.WU.wallet_switchEthereumChain:case b.WU.wallet_addEthereumChain:{ge(e),await o();const t=a===b.WU.wallet_addEthereumChain?"add":"switch";return await ye(s,t,e,r)}case b.WU.wallet_getSnaps:case b.WU.wallet_requestSnaps:ge(e),await o(),s.reply({result:{}});case b.WU.eth_sign:case b.WU.eth_signTransaction:case b.WU.eth_ecRecover:case b.WU.wallet_watchAsset:case b.WU.wallet_registerOnboarding:throw F.Sy.provider.unsupportedMethod();default:if(a.startsWith("wallet"))throw F.Sy.provider.unsupportedMethod();await o(),s.reply(await Ot(n,a,r))}}catch(t){let e;if("code"in t){const{message:n,code:a,data:r}=t;e={message:n,code:a,data:r}}else e=F.Sy.rpc.internal();s.reply({error:e})}}function ge(t){if("self"===t.type)throw F.Sy.provider.unsupportedMethod()}var we=n(94375),fe=n(62990),ve=n(53213),Se=n(13411),be=n(96934),Ae=n(39733),ke=n(27929),Ue=n(12229),Te=n(64525);function _e(t){t=it.K(t);const e=H.getState().find((e=>e.address===t));return(0,et.h)(e,"Account not found"),(0,et.h)(e.source!==b.iL.Address,"This wallet was added as a watch-only account by importing an address. It is not possible to perform signing using this type of accounts."),e}const xe=["to","data","accessList","chainId","value"];function Pe(t){if(void 0!==t)return["string","number","bigint"].includes(typeof t)?Ue.B4(t):t}async function Ce(t,{approved:e,rawTx:n,signature:a,signedMessage:r,accountAddresses:s,overriddenChainId:o},i){const c=Y.getState().find((e=>e.id===t));(0,et.h)(c,"Not Found"),e?await(0,p.EQ)(c).with({type:b.T8.Connection},(async({rpcCtx:t,type:e,source:n,returnSelectedAccount:a,preferredChainId:r})=>{(0,et.h)(s?.length,"Accounts not provided");const i=(0,N.o)(n),c=await S.t.fetchForce(b.hC);c&&s.includes(c)&&(s=[c,...s.filter((t=>t!==c))]);const u=Date.now(),l={origin:i,id:(0,$t.x0)(),timeAt:u,accountAddresses:s,chainId:o??r??fe.H8.chainId};await d.mk.put(l),c&&!s.includes(c)&&await S.t.put(b.hC,s[0]);const p=a?s[0]:(0,N.H)(l);await(0,Ae.d)(s.map((t=>({id:(0,$t.x0)(),type:e,source:n,returnSelectedAccount:a,preferredChainId:r,accountAddress:t,timeAt:u,pending:0})))),t?.reply({result:[p]})})).with({type:b.T8.Transaction},(async({rpcCtx:t,type:e,source:r,chainId:s,accountAddress:o,txParams:c})=>{(0,et.h)(n,"Transaction not provided");const d=function(t){const e=ke.Y.from(t);return e.signature=null,e}(n);if(function(t,e){for(const n of xe){const a=Pe(t[n]),r=Pe(e[n]);r&&(0,et.h)((0,Te.J)(a,r),"Invalid transaction")}}(d,c),!a){const t=_e(o=it.K(o));a=await i.sign(t.uuid,we.w(n))}const u=d.clone();u.signature=a;const l=await async function(t,e){const n=await Ot(t,"eth_sendRawTransaction",[e.serialized]);if("result"in n)try{const n=fe.T3.find((e=>e.chainId===t)),a=n?.rpcUrls.slice(1,1+ve.DK);if(a)for(const t of a)fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"eth_sendRawTransaction",params:[e.serialized]})}).then((t=>{t.ok}))}catch(t){}return n}(s,u);if(!("result"in l)){const{message:t,...e}=l.error,n=new Error(t);throw Object.assign(n,{data:e}),n}{const a=l.result,i=Date.now(),u=await(0,be.m9)(Vt(s),c).catch((()=>null));await Promise.all([(0,Se.f4)(s,o,d.nonce),(0,Ae.d)({id:(0,$t.x0)(),type:e,source:r,chainId:s,accountAddress:o,txParams:c,rawTx:n,txAction:u??void 0,txHash:a,timeAt:r.replaceTx?.prevTimeAt??i,pending:1}),(0,Ae.E)(u,s,o,a,i)]),t?.reply({result:a})}})).with({type:b.T8.Signing},(async({rpcCtx:t,type:e,source:n,standard:a,accountAddress:s,message:o})=>{if(r)return void t?.reply({result:r});const c=_e(s=it.K(s)),d=i.signMessage(c.uuid,a,o);await(0,Ae.d)({id:(0,$t.x0)(),type:e,source:n,standard:a,accountAddress:s,message:o,timeAt:Date.now(),pending:0}),t?.reply({result:d})})).with({type:b.T8.AddNetwork},(async({rpcCtx:t,source:e,chainId:n})=>{const a=(0,N.o)(e);await d.xJ(a,n),t?.reply({result:null})})).otherwise((()=>{throw new Error("Not Found")})):c.rpcCtx?.reply({error:F.Sy.provider.userRejectedRequest()}),I(t)}var Ie=n(70794),De=n(92707),Re=n(59878),Ee=n(74780),Me=n.n(Ee),Fe=n(13808);const Ne=(0,Lt.ZP)((async t=>{try{return(await Ke()).find((e=>+e.chain_id===t))}catch(t){return}})),Ke=(0,Lt.ZP)((()=>Fe.j.get("/c/v1/chains/").then(Be)),{maxAge:36e5});function Be(t){if(t.data?.error)throw new Error(t.data.error_message||"Unknown c-indexer error");return t.data?.data?.items??[]}const Le=(0,Lt.ZP)((async t=>{try{return(await Ze()).find((e=>e.community_id===t))}catch(t){return}})),Ze=(0,Lt.ZP)((()=>Fe.j.get("/d/v1/chain/list").then((t=>t.data))),{maxAge:36e5}),He=async(t,e)=>{const{data:n}=await Fe.j.get(`/ns/v2/account/own/all/${e}`,{params:{_authAddress:e,chainId:t,show_attribute:!1,sort_field:"latest_trade_price"}});if(200===n.code&&n.data)return n.data;throw new Error(n.msg||"Unknown error")},je=18e4,We=864e5,Ye=a.Z.create({baseURL:"https://api.coingecko.com/api/v3",timeout:9e4}),Oe=a.Z.create({baseURL:"https://api.geckoterminal.com/api/v2",timeout:9e4}),Ve=a.Z.create({baseURL:"https://api.dexscreener.com/latest",timeout:9e4}),Ge=new(Me())(je);async function $e(t){try{if(0===t.length)return{};if(t.length>1e3)return{};const e=await Je(),n={},a=[],r=new Set,s=new Set;for(const o of t){const t=e[o.toLowerCase()],i=Ge.get(t??o);i?n[o]=i:t?(a.push({tokenAddress:o,coinId:t}),r.add(t)):s.add(o)}if(r.size>0){const t={},e=Array.from(r);for(;e.length>0;){const n=e.splice(0,100),a=await Fe.j.get("/cg/simple/price",{params:{ids:n.join(),vs_currencies:"USD",include_24hr_change:!0}}).catch((()=>null));a&&Object.assign(t,a.data)}for(const e in t)Ge.set(e,t[e]);for(const{tokenAddress:e,coinId:r}of a){const a=t[r];a&&(n[e]=a)}}if(s.size>0&&s.size<=500){const t=Array.from(s);for(;t.length>0;){const e=t.splice(0,30),a=await Ve.get(`/dex/tokens/${e.join()}`).catch((()=>null)),r=a?.data?.pairs;if(r)for(const t of r){const e=new Ie.Z(t.liquidity?.usd);if(e.isNaN()||e.isLessThan(100))continue;{const e=new Ie.Z(t.liquidity.base),n=new Ie.Z(t.liquidity.quote);if(e.isLessThan(.01)||n.isLessThan(.01))continue}const a=(0,it.K)(t.baseToken?.address),r=n[a];if(r?.usd_reserve&&new Ie.Z(r.usd_reserve).isGreaterThan(e))continue;const s=new Ie.Z(t.priceUsd).toNumber();if(!s)continue;const o={usd:s,usd_24h_change:new Ie.Z(t.priceChange?.h24).toNumber()||void 0,usd_reserve:e.toString()};n[a]=o,Ge.set(a,o)}}}return n}catch(t){return{}}}const qe=async t=>{try{const e=await Xe(),n=e[t]?.native_coin_id;if(!n)return null;const a=await ze();return n in a?a[n]:null}catch(t){return null}},ze=(0,Lt.ZP)((async()=>{const t=await Xe(),{data:e}=await Fe.j.get("/cg/simple/price",{params:{ids:Object.values(t).map((t=>t.native_coin_id)).join(),vs_currencies:"USD",include_24hr_change:!0}});return e}),{maxAge:je}),Je=(0,De.H)((async()=>{const{data:t}=await Ye.get("/coins/list",{params:{include_platform:!0}}),e={};for(const n of t)for(const t of Object.values(n.platforms))try{(0,zt.UJ)(t)&&(e[t]=n.id)}catch{}return e}),{key:"cg_coins_list",hotMaxAge:5e3,coldMaxAge:We}),Xe=((0,De.H)((async()=>{const t=await Xe(),e={};for(const n in t)e[t[n].id]=+n;const n={};let a=1;for(;;){const{data:t}=await Oe.get("/networks",{params:{page:a}});for(const a of t.data){const t=a.attributes.coingecko_asset_platform_id;if(!t)continue;const r=e[t];r&&(n[r]=a.id)}if(!t.links.next||a>4)break;a++}return n}),{key:"cgt_networks",hotMaxAge:5e3,coldMaxAge:We}),(0,De.H)((async()=>{const{data:t}=await Ye.get("/asset_platforms"),e={};for(const{id:n,chain_identifier:a,native_coin_id:r}of t)n&&a&&"number"===typeof a&&(e[a]={id:n,native_coin_id:r});return e}),{key:"cg_asset_platforms",hotMaxAge:5e3,coldMaxAge:We})),Qe=(0,De.H)((async()=>{try{const{data:t}=await Ye.get("/exchange_rates"),e=t.rates;if(!e.usd)return;const n=new Ie.Z(e.usd.value),a=new Ie.Z(1).dividedBy(n),r={};for(const{code:t}of Re.g){const n=e[t.toLowerCase()];n&&(r[t]=new Ie.Z(n.value).times(a).toString())}return await S.t.put("currencies_rate",r),!0}catch(t){return!1}}),{key:"cg_conversion_rates",hotMaxAge:6e4,coldMaxAge:36e5}),tn=new Map;var en=n(53166);function nn(t){return d.ru.where("[chainId+accountAddress+tokenSlug+pending]").equals([t.chainId,t.accountAddress,t.tokenSlug,0]).reverse().first()}function an(){const t=new Map,e=new Set;return{addToActivities:n=>{const a=(0,en.PT)(n),r=t.get(a);r?"transfer"===n.type&&(r.amount=r.amount&&(BigInt(r.amount)+BigInt(n.amount)).toString()):t.set(a,n),e.add(n.timeAt)},releaseToRepo:async()=>{t.size>0&&await d.ru.bulkPut(Array.from(t.values()),Array.from(t.keys()))},getCurrentState:()=>({tokenActivities:t,blockNumbers:e})}}async function rn(t){const{chainId:e,tokenSlug:n,accountAddress:a,tokenType:r}=t;if(n!==en.mg)return;const s=await Le(e);if(!s)return;const{addToActivities:o,releaseToRepo:i}=an(),c=s.native_token_id,d=new Ie.Z(10).pow(r===b.iv.Asset?t.decimals:0),u=await nn(t),l=u?1:2;let p;for(let t=0;t<l;t++){const{data:t}=await Fe.j.get("/d/v1/user/history_list",{params:{_authAddress:a,id:a,chain_id:s.id,token_id:c,page_count:20,start_time:p}}),r=t?.history_list;if(!Array.isArray(r)||0===r.length)break;let i=!1;for(const{id:s,sends:l,receives:p,token_approve:h,time_at:y,project_id:m}of r){const r=1e3*y;if(u&&u.timeAt>=r){i=!0;break}const g={chainId:e,accountAddress:a,tokenSlug:n,txHash:s,pending:0,timeAt:r};if(m){const e=t.project_dict[m];e&&(g.project={name:e.name,logoUrl:e.logo_url,siteUrl:e.site_url})}let w=!1;for(const t of l)t.token_id===c&&(w=!0,o({...g,type:"transfer",anotherAddress:it.K(t.to_addr),amount:new Ie.Z(t.amount).times(d).integerValue().times(-1).toString()}));for(const t of p)t.token_id===c&&(w=!0,o({...g,type:"transfer",anotherAddress:it.K(t.from_addr),amount:new Ie.Z(t.amount).times(d).integerValue().toString()}));if(!w&&h&&h.token_id===c){const t=new Ie.Z(h.value).times(d).integerValue();o({...g,type:"approve",anotherAddress:it.K(h.spender),amount:t.toString(),clears:t.isZero()})}}if(i)break;p=r[r.length-1].time_at}return await i(),!0}async function sn(t){const{chainId:e,tokenSlug:n,accountAddress:a,tokenType:r}=t;if(r!==b.iv.Asset||n===en.mg)return;const s=await nn(t),{address:o}=(0,en.Sz)(n),{data:i}=await Fe.j.get(`/u/v3/${e}/address/${a}/transactions`,{params:{_authAddress:a,contract:o,pageSize:100,...s?.blockNumber?{fromBlock:s.blockNumber+1}:{}}});if(!i?.transactions?.length)return!0;const{addToActivities:c,releaseToRepo:d}=an();for(const t of i.transactions){const r={chainId:e,accountAddress:a,tokenSlug:n,txHash:t.id,pending:0,timeAt:1e3*t.date,blockNumber:t.block};for(const e of["sent","received"])for(const n of t[e]??[]){if((0,it.K)(n.token_id)!==o)break;const e=on(t.description);e&&(r.project={name:e}),(0,it.K)(n.from)===a?c({...r,type:"transfer",anotherAddress:(0,it.K)(n.to),amount:new Ie.Z(n.value).integerValue().times(-1).toString()}):(0,it.K)(n.to)===a&&c({...r,type:"transfer",anotherAddress:(0,it.K)(n.from),amount:new Ie.Z(n.value).integerValue().toString()})}}return await d(),!0}function on(t){try{if(t.startsWith("Swapped on ")){const e=t.split(":");if(e.length>1)return e[0].replace("Swapped on ","")}}catch(t){}return null}async function cn(t){const{chainId:e,tokenSlug:n,accountAddress:r,tokenType:s}=t,{explorerApiUrl:o}=await(0,Zt.Hy)(e);if(!o)return;const i=n===en.mg,{standard:c,address:d,id:u}=(0,en.Sz)(n),l=await nn(t),p=i?"txlist":c===b.Yn.ERC721?"tokennfttx":c===b.Yn.ERC1155?"token1155tx":"tokentx",{data:h}=await(y=()=>(0,a.Z)({baseURL:o,params:{module:"account",action:p,...i?{}:{contractaddress:d},address:r,sort:"desc",page:1,offset:500}}).then((t=>{if("NOTOK"===t.data?.message)throw new Error(t.data.result);return t})),dn((async()=>(un&&await new Promise((t=>setTimeout(t,un-Date.now()))),y().finally((()=>{un=Date.now()+5e3}))))));var y;let m=h.result;if(!m||0===m.length)return!0;s===b.iv.NFT&&(m=m.filter((t=>t.tokenID===u)));const{addToActivities:g,releaseToRepo:w}=an(),f={chainId:e,accountAddress:r,tokenSlug:n,pending:0};for(const t of m){const e=new Ie.Z(t.timeStamp).times(1e3).toNumber();if(l&&l.timeAt>=e)break;if("0"===t.value||""===t.blockHash||"1"===t.isError)continue;const[n,a]=[t.from,t.to].map((t=>t&&(0,it.K)(t)));if(!n||!a)continue;const s=r===a,o=t.value||t.tokenValue||"1";g({...f,timeAt:e,txHash:t.hash,type:"transfer",anotherAddress:s?n:a,amount:(BigInt(o)*(s?1n:-1n)).toString()})}return await w(),!0}const dn=(0,h.j)();let un;var ln=n(54773);async function pn(t){const{chainId:e,tokenSlug:n,accountAddress:a,tokenType:r}=t,{standard:s,address:o}=(0,en.Sz)(r)}const hn=(0,Lt.ZP)((async(t,e,n)=>{const a=(0,en.pO)({chainId:t,accountAddress:e,tokenSlug:n});E(a);try{const t=await d.hI.get(a);if(!t)return;for(const e of[rn,sn,cn,pn])try{if(await e(t))break}catch(t){}}finally{M(a)}}),{maxAge:4e4,cacheKey:t=>t.join("_")});async function yn(t){return Object.fromEntries(await Promise.all(Object.entries(t).map((async([t,e])=>[t,await e]))))}var mn=n(72047),gn=n.n(mn);var wn=n(48737),fn=n(87823),vn=n(18083),Sn=n(51995);function bn(t){const e=t.indexOf(",")+1;return t.slice(0,e)+encodeURIComponent(t.slice(e))??""}const An={1:" X/\\",2:"+-|",3:"/\\",4:"|-/",5:"O|-",6:"\\",7:"#|-+",8:"OO",9:"#",10:"#O"};function kn(t){return t.replace(/-/g," ")}function Un(t,e,a,r){if((0,vn.tk)(t,e,fn.Jq))return async function(t,e,n){const a=new wn.CH(t,["function symbolScheme(uint256 index) public view returns (uint8)"],n),r=await a.symbolScheme(e);return{properties:{"Symbol Scheme":An[r]||"Unknown"}}}(e,a,r);if((0,vn.tk)(t,e,fn.Vj))return async function(t,e,n){const a=new wn.CH(t,["function tokenNameByIndex(uint256 index) public view returns (string memory)"],n);return{name:await a.tokenNameByIndex(e)}}(e,a,r);if((0,vn.tk)(t,e,fn.uy)||(0,vn.tk)(t,e,fn.fA))return async function(t,e,a){const{default:r}=await n.e(80).then(n.bind(n,86080)),s=new wn.CH(t,["function seeds(uint256 tokenId) public view returns (uint48,uint48,uint48,uint48,uint48)"],a),[o,i,c,d,u]=await s.seeds(e),l={background:kn(r.background[o]),body:kn(r.body[i]),accessory:kn(r.accessory[c]),head:kn(r.head[d]),glasses:kn(r.glasses[u])},p={};return t===fn.fA[1]&&(p.name=`Lil Noun ${e}`),{...p,attributes:[...Object.keys(l).map((t=>({trait_type:t,value:l[t]})))]}}(e,a,r);if((0,vn.tk)(t,e,fn.wq)){return async function(t,e,n){const a=new wn.CH(t,["function punkAttributes(uint16 index) public view returns (string memory)","function punkImageSvg(uint16 index) public view returns (string memory)"],n),[r,...s]=(await a.punkAttributes(e)).split(",");return{image:bn(await a.punkImageSvg(e)),attributes:[{trait_type:"Type",value:r},...s.map((t=>({trait_type:"Accessory",value:t})))]}}(fn.$N[t],a,r)}return(0,vn.tk)(t,e,fn.uU)?async function(t,e,a){const{default:r}=await n.e(703).then(n.t.bind(n,23703,19)),s=new wn.CH(t,r,a);return{contentURL:await s.tokenURI(e)}}(e,a,r):(0,vn.tk)(t,e,fn.$)?async function(t,e,a){const{default:r}=await n.e(563).then(n.t.bind(n,60563,19)),s=new wn.CH(t,r,a),[o,i,c,d,u,l,p]=await Promise.all([s.getChest(e),s.getFoot(e),s.getHand(e),s.getHead(e),s.getNeck(e),s.getRing(e),s.getWaist(e),s.getWeapon(e)]);return{attributes:[{trait_type:"Chest",value:o},{trait_type:"Foot",value:i},{trait_type:"Hand",value:c},{trait_type:"Neck",value:d},{trait_type:"Ring",value:u},{trait_type:"Waist",value:l},{trait_type:"Weapon",value:p}]}}(e,a,r):Promise.resolve({})}function Tn(t){return Array.isArray(t)?t:"object"===typeof t?Object.keys(t).map((e=>({value:t[e],trait_type:e}))):t}class _n extends Error{}class xn{chainId;provider;timeout;ipfsGatewayUrl;ipfsFallbackGatewayUrl;constructor(t,e,n={}){this.chainId=t,this.provider=e,this.ipfsGatewayUrl=n.ipfsGatewayUrl||fn.ey,this.ipfsFallbackGatewayUrl=n.ipfsFallbackGatewayUrl||fn.Jb,this.timeout=n.timeout||4e4}async fetchTokenURI(t,e){const n=(0,Sn.FL)(this.chainId,t,e);if(n)return n;const a=await(0,Sn.TK)(this.chainId,t,e,this.provider);if(a)return a;try{const n=ln.aC.connect(t,this.provider);return{uri:await n.tokenURI(e),type:"ERC721"}}catch{}try{const n=new wn.CH(t,["function uri(uint256 index) public view returns (string memory)"],this.provider);let a=await n.uri(e);return a.includes("{id}")&&(a=a.replace("{id}",(0,vn.Vv)(e))),{uri:a,type:"ERC1155"}}catch(t){}throw new _n("Cannot fetch uri from contract")}async fetchURIData(t,e,n,a){const r=(0,Sn.zD)(this.chainId,t,e);if(r)return r;const s=await(0,Sn.gN)(n,{timeout:this.timeout},a,this.ipfsFallbackGatewayUrl);if(!s)throw new Error(`Failed to fetch uri data for token from: ${n}`);return s}async parseURIData(t,e,n,a={},r){const s=await Un(this.chainId,t,e,this.provider),o=function(t,e,n){let a=n;if((0,vn.tk)(t,e,fn.BN)){const t=a?.properties?.preview_media_file2&&"mp4"===a?.properties?.preview_media_file2_type?.description?a?.properties?.preview_media_file2.description:void 0;t&&(a.animation_url=t)}var r;(0,vn.tk)(t,e,fn.X2)&&(a={...a,contentURLMimeType:a.animation_url?.endsWith("glb")?"model/gltf-binary":void 0}),(0,vn.tk)(t,e,fn.uU)&&(a="body"in(r=a)?{origin:"catalog-20210202",version:"zora-20210604",name:r.body.title,description:r.body.notes||"",mimeType:r.body.mimeType,image:r.body?.artwork?.isNft?void 0:r.body?.artwork?.info?.uri,external_url:"https://catalog.works",...r}:r),(0,vn.tk)(t,e,fn.kC)&&(a=Object.entries(a.properties).reduce(((t,[e,n])=>(t[e]=n.description,t)),{})),(0,vn.tk)(t,e,fn.yE)&&(a={...a,...a.media&&{contentURL:a.media.uri,contentURLMimeType:a.media.mimeType}}),(0,vn.tk)(t,e,fn.iL)&&(a={...a,...a.animation_url&&{animation_url:a.image}}),a.properties&&(a={...a,attributes:a.properties});const s=a.attributes||a.traits,o=a.image||a.image_url;return{...a,...o&&{image:o},...s&&{attributes:Tn(s)}}}(this.chainId,t,{...a,...s,...a?.mimeType&&{contentURLMimeType:a.mimeType}});o.image&&(o.imageURL=(0,vn.Nm)(o.image,r)),o.image_data&&(o.imageURL=(0,Sn.Ic)(fn.K3,o.image_data),o.imageURLMimeType=fn.K3),o.animation_url&&(o.contentURL=(0,vn.Nm)(o.animation_url,r)),!o.contentURL&&o.imageURL&&(o.contentURL=o.imageURL),o.contentURL&&!o.contentURLMimeType&&(o.contentURLMimeType=await(0,Sn.Mo)(o.contentURL,{timeout:this.timeout})),o.imageURL&&!o.imageURLMimeType&&(o.imageURLMimeType=await(0,Sn.Mo)(o.imageURL,{timeout:this.timeout}));const{name:i,description:c,attributes:d,external_url:u,imageURL:l,imageURLMimeType:p,contentURL:h,contentURLMimeType:y}=o;return{tokenURL:(0,vn.Nm)(n),tokenURLMimeType:"application/json",...i&&{name:i},...c&&{description:c},...l&&{imageURL:l},...p&&{imageURLMimeType:p},...h&&{contentURL:h},...y&&{contentURLMimeType:y},...d&&{attributes:d},...u&&{externalURL:u}}}async fetchMetadata(t,e){const n=it.K(t);try{const t=await this.fetchTokenURI(n,e),{uri:a,type:r}=t,s=(0,Sn.p6)(this.chainId,n)||this.ipfsGatewayUrl,o=await this.fetchURIData(n,e,a,s);return{tokenId:e,tokenAddress:n,metadata:o,tokenURI:a,tokenType:r,...await this.parseURIData(n,e,a,o,s)}}catch(t){if(t instanceof _n)throw new Error(`Failed to get tokenURI token: ${n} is unsupported`);throw t}}}var Pn=n(26389);function Cn(t){return t?.includes("image")?"image_url":t?.includes("video")?"video_url":t?.includes("audio")?"audio_url":void 0}const In=async(t,e,n=!1)=>{const a=Vt(t),{standard:r,address:s,id:o}=(0,en.Sz)(e);try{switch(r){case b.Yn.ERC20:{const t=ln.w6.connect(s,a);return await gn()((()=>yn({decimals:t.decimals(),symbol:t.symbol(),name:t.name()})),{retries:2})}case b.Yn.ERC721:case b.Yn.ERC1155:{const e=new xn(t,a),[c,d]=await Promise.all([r===b.Yn.ERC721?ln.aC.connect(s,a).name().catch((()=>null)):null,e.fetchMetadata(s,o).catch((()=>null))]);if(!n&&!d)return null;return function(t){const e={...t};for(const n in t){const a=t[n];a&&(e[n]=a)}return e}({contractAddress:s,tokenId:o,name:d?.name??`${c?`${c} `:""}#${o}`,collectionName:c??void 0,collectionId:c?(i=c,i.toString().normalize("NFKD").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/\-$/g,"")):void 0,description:d?.description,thumbnailUrl:d?.imageURL,contentUrl:d?.contentURL,detailUrl:d?.externalURL,contentType:Cn(d?.contentURLMimeType),attributes:d?.attributes})}default:throw new Error("Unhandled Token ERC standard")}}catch(t){}var i;return null},Dn=(0,Lt.ZP)((async(t,e,n)=>{const a=Vt(t);return(0,Pn.v)(a,e,n).catch((()=>null))}),{cacheKey:t=>t.join("_"),maxAge:3e3});async function Rn(t,e,n){const a=await d.hI.where("[chainId+tokenType+accountAddress]").equals([t,n,e]).toArray();let r;if(n===b.iv.NFT){r=[];const t=[];for(const e of a)e.tokenId.includes("e+")?t.push((0,en.pO)(e)):r.push(e);t.length>0&&await d.hI.bulkDelete(t).catch(console.error)}else r=a;const s=new Map(r.filter((t=>t.tokenSlug!==en.mg)).map((t=>[t.tokenSlug,t]))),o=[],i=[];return{existingAccTokens:r,existingTokensMap:s,addToken:n=>{o.push(n),i.push((0,en.pO)({chainId:t,accountAddress:e,tokenSlug:n.tokenSlug})),s.delete(n.tokenSlug)},accTokens:o,releaseToRepo:()=>d.hI.bulkPut(o,i)}}const En="0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000",Mn=(0,Lt.ZP)((async(t,e)=>{const[n,a,{existingTokensMap:r,accTokens:s,addToken:o,releaseToRepo:i}]=await Promise.all([(0,Zt.Hy)(t),Fn(t,e).catch((t=>[])),Rn(t,e,b.iv.Asset)]);for(const s of a){if(s.native_token??"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"===s.contract_address)continue;const a=it.K(s.contract_address),i=(0,en.Vy)({standard:b.Yn.ERC20,address:a,id:"0"}),c=r.get(i);if(c?.syncedByChainAt&&c.syncedByChainAt>Date.now()-18e4)continue;const d=new Ie.Z(s.balance).integerValue();if(!c&&d.isZero()||"mainnet"===n.type&&(!s.contract_ticker_symbol||!s.contract_decimals)||a===En)continue;const u={symbol:s.contract_ticker_symbol?.slice(0,8)||c?.symbol||"NONAME",name:s.contract_name||c?.name||"Unknown",decimals:s.contract_decimals??c?.decimals??18,logoUrl:"mainnet"===n.type?s.logo_url||void 0:c?.logoUrl},l=d.toString(),p=s.quote_rate?new Ie.Z(s.quote_rate).toString():c?.priceUSD,h=s.quote||(p?d.div(new Ie.Z(10).pow(u.decimals)).times(p).toNumber():c?.balanceUSD??0);o({...c??{chainId:t,accountAddress:e,tokenSlug:i,tokenType:b.iv.Asset,status:b.YF.Enabled},...u,rawBalance:l,balanceUSD:h,priceUSD:p})}const c=Array.from(r.values());if(c.length>0){const n=await Promise.all(c.map((({tokenSlug:n})=>Dn(t,n,e))));for(let t=0;t<c.length;t++){const e=n[t];if(null===e)continue;o({...c[t],rawBalance:e.toString(),syncedByChainAt:Date.now()})}}const d=s.map((t=>(0,en.Sz)(t.tokenSlug).address)),u=await $e(d);if(Object.keys(u).length>0)for(let t=0;t<s.length;t++){const e=s[t],n=d[t],a=n!==En?u[n]:null;if(a&&a.usd){const t=new Ie.Z(a.usd),n=new Ie.Z(e.rawBalance);e.priceUSD=t.toString(),e.priceUSDChange=a.usd_24h_change?.toString(),e.balanceUSD=n.div(new Ie.Z(10).pow(e.decimals)).times(t).toNumber(),a.usd_reserve&&(e.balanceUSD=Ie.Z.min(e.balanceUSD,a.usd_reserve).toNumber()),e.manuallyStatusChanged||(e.status=n.isZero()?b.YF.Disabled:b.YF.Enabled)}else e.balanceUSD=0,delete e.priceUSD,delete e.priceUSDChange,e.manuallyStatusChanged||(e.status=b.YF.Disabled)}await i()}),{cacheKey:t=>t.join("_"),maxAge:4e4}),Fn=(t,e)=>Nn.has(t)?Fe.j.get(`/u/v1/${t}/address/${e}/assets`,{params:{_authAddress:e,verified:!0}}).then((t=>t.data)):(async(t,e,n)=>{const a=await Ne(t);if(!a)return[];const r=n===b.iv.Asset?"balances_v2":"balances_nft",s=`/c/v1/${a.name}/address/${e}/${r}/`;return await Fe.j.get(s,{params:{_authAddress:e,"no-spam":!0}}).then(Be)})(t,e,b.iv.Asset),Nn=new Set([1,56,137,42220,8217,25,106,42161,43114,50,32769,250,122,1313161554,1088,5e3,1101,1284,10,8453]),Kn=(0,Lt.ZP)((async(t,e)=>{const n=await d.hI.where("[chainId+tokenType+accountAddress]").equals([t,b.iv.Asset,e]).toArray();let a=new Ie.Z(0);for(const t of n)t.status!==b.YF.Disabled&&(a=a.plus(t.balanceUSD??0));const r=a.toString(),s=await d.hI.where("[accountAddress+tokenSlug]").equals([e,At.mg]).toArray();let o,i=new Ie.Z(0);for(const e of s)e.chainId===t&&(o=e),e.portfolioUSD&&(i=i.plus(e.portfolioUSD));o&&await d.hI.put({...o,portfolioUSD:r,portfolioRefreshedAt:Date.now()},(0,At.pO)({chainId:t,accountAddress:e,tokenSlug:At.mg})),(0,At.vt)(e,i)}),{cacheKey:t=>t.join(),maxAge:5e3}),Bn=(0,De.H)((async(t,e)=>{const n=await Fn(t,e),a=await(0,At.Hy)(t).catch((()=>null));let r=new Ie.Z(0);for(const t of n)("mainnet"!==a?.type||t.contract_ticker_symbol&&t.contract_decimals)&&"0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000"!==(0,it.K)(t.contract_address)&&t.quote&&(r=r.plus(t.quote));return r.toString()}),{key:([t,e])=>`total_balance_${t}_${e}`,hotMaxAge:3e4,coldMaxAge:6e5}),Ln=(0,Lt.ZP)((async(t,e)=>{const[n,a]=await Promise.all([d.hI.where("[accountAddress+tokenSlug]").equals([t,en.mg]).toArray(),Zn(t).catch((t=>[]))]),r=new Map(n.map((t=>[t.chainId,t]))),s=n.filter((t=>t.portfolioUSD&&new Ie.Z(t.portfolioUSD).isGreaterThan(0))).map((t=>t.chainId)),o=a.filter((t=>!s.includes(t))),i=new Set([...s,...o,e]),c=[];for(const t of i)try{c.push(await(0,Zt.Hy)(t))}catch(t){}const u=c.map((({chainId:e})=>(0,en.pO)({chainId:e,accountAddress:t,tokenSlug:en.mg}))),l=await Promise.all(c.map((n=>{const{chainId:a,nativeCurrency:s,type:o}=n,i=r.get(a),c=!i||a===e,d=i?.portfolioRefreshedAt&&i.portfolioRefreshedAt>Date.now()-864e5,u="testnet"!==o&&"ETH"===s.symbol;return yn({chainId:a,balance:c?Dn(a,en.mg,t):null,cgPrice:qe(u?1:a),totalBalance:d?null:Bn(a,t).catch((()=>null))})})));if(await d.hI.bulkPut(c.map(((e,n)=>{const{chainId:a,nativeCurrency:s,chainTag:o}=e,{balance:i,cgPrice:c,totalBalance:d}=l[n],u=r.get(a),p=c?.usd?.toString(),h=c?.usd_24h_change?.toString(),y=d||u?.portfolioUSD||"0",m={decimals:s.decimals,name:s.name,symbol:s.symbol,logoUrl:(0,en.A$)(o)};if(u){if(!i)return{...u,priceUSD:p,priceUSDChange:h,portfolioUSD:y};const t=i.toString(),e=p?new Ie.Z(t).div(new Ie.Z(10).pow(s.decimals)).times(p).toNumber():u.balanceUSD;return{...u,...m,rawBalance:t,balanceUSD:e,priceUSD:p,priceUSDChange:h,portfolioUSD:y}}{const e=i?.toString()??"0",n=i&&p?new Ie.Z(e).div(new Ie.Z(10).pow(s.decimals)).times(p).toNumber():0;return{chainId:a,accountAddress:t,tokenType:b.iv.Asset,status:b.YF.Native,tokenSlug:en.mg,...m,rawBalance:e,balanceUSD:n,priceUSD:p,priceUSDChange:h,portfolioUSD:y}}})),u),0===n.length){const t=function(t,e){let n;for(const a of t)n&&!e(n,a)||(n=a);return n}(l,((t,e)=>!t?.totalBalance||(e.totalBalance?new Ie.Z(e.totalBalance).isGreaterThan(t.totalBalance):void 0)));if(t)return t?.chainId}}),{maxAge:1e4,cacheKey:t=>t.join()});const Zn=(0,De.H)((async t=>{const e=await a.Z.get(`https://api.llamafolio.com/balances/${t}/tokens`).then((t=>t.data)).catch((()=>null));if(!e){const e=await Fe.j.get(`/c/v1/address/${t}/activity/`,{params:{_authAddress:t}});return(e.data?.data?.items??[]).map((t=>+t.chain_id))}return e.chains.map((t=>t.chainId))}),{key:([t])=>`networks_${t}`,hotMaxAge:3e4,coldMaxAge:6e5});const Hn=(0,Lt.ZP)((async(t,e)=>{if("mainnet"!==(await(0,Zt.Hy)(t)).type)return;const[n,{existingTokensMap:a,addToken:r,releaseToRepo:s}]=await Promise.all([He(t,e),Rn(t,e,b.iv.NFT)]);for(const s of n){if(!s.assets?.length)continue;const n=it.K(s.contract_address);for(const o of s.assets){const i=o.erc_type?.includes("erc1155")?b.Yn.ERC1155:b.Yn.ERC721,c=o.token_id,d=(0,en.Vy)({standard:i,address:n,id:c}),u=a.get(d);if(u?.status===b.YF.Disabled)continue;if(!u&&!o.image_uri&&!o.content_uri)continue;const l=o.amount&&new Ie.Z(o.amount);if(!l||!u&&l.isZero())continue;const p=o.latest_trade_price?new Ie.Z(o.latest_trade_price).toString():u?.priceUSD,h=s.contract_name||void 0,y=o.description||void 0,m=o.image_uri||void 0,g=o.content_uri||void 0,w=o.nftscan_uri||void 0,f=o.external_link||void 0,v=u?.contentType||Cn(o?.content_type??void 0),S={contractAddress:n,tokenId:c,name:u?.name||o?.name||`#${c}`,description:u?.description||y,thumbnailUrl:u?.thumbnailUrl||(0,vn.Nm)(w||m||("image_url"===v?g:void 0)),contentUrl:u?.contentUrl||(0,vn.Nm)(g??m??w),contentType:v,collectionId:u?.collectionId,collectionName:u?.collectionName||h,detailUrl:u?.detailUrl||f,attributes:u?.attributes??o?.attributes?.filter(Boolean),priceUSD:p,tpId:o.nftscan_id},A=jn(u,l,S),k=l.toString(),U=u?.balanceUSD??0;r({...u??{chainId:t,accountAddress:e,tokenSlug:d,tokenType:b.iv.NFT},...S,status:A,rawBalance:k,balanceUSD:U})}}if(a.size>0&&a.size<50){const n=Array.from(a.values()),s=await Promise.all(n.map((({tokenSlug:n})=>Dn(t,n,e))));for(let t=0;t<n.length;t++){const e=s[t];if(null===e)continue;const a=n[t],o=e.toString(),i=jn(a,o,a);r({...a,rawBalance:o,status:i})}}await s()}),{cacheKey:t=>t.join("_"),maxAge:6e4});function jn(t,e,n){return t?.manuallyStatusChanged||function({name:t,description:e}){for(const n of[t,e]){if(!n)continue;const t=n.toLowerCase();if(["airdrop","reward","voucher"].some((e=>t.includes(e))))return!1}return!0}(n)?t?!t.manuallyStatusChanged&&new Ie.Z(e).isZero()?b.YF.Disabled:!t.manuallyStatusChanged&&new Ie.Z(t.rawBalance).isZero()&&new Ie.Z(e).isGreaterThan(0)?b.YF.Enabled:t.status:b.YF.Enabled:b.YF.Disabled}const Wn=new Set;async function Yn(t,e,n,a=!1){const r=(0,At.pO)({chainId:t,accountAddress:e,tokenSlug:n});if(!Wn.has(r)){Wn.add(r),E(e);try{await async function(t,e,n,a,r=!1){const{standard:s,address:o}=(0,At.Sz)(a),i=await d.hI.get(t),c=async(a,r=0)=>{if(await d.hI.put({...a,syncedByChainAt:Date.now(),manuallyStatusChanged:!0},t),a.tokenType===b.iv.Asset){const t=(0,At.pO)({chainId:e,accountAddress:n,tokenSlug:At.mg}),s=a.tokenSlug===At.mg?a:await d.hI.get(t),o=new Ie.Z(a.balanceUSD).minus(r);if(s?.portfolioUSD){const e=new Ie.Z(s.portfolioUSD).plus(o).toString();await d.hI.put({...s,portfolioUSD:e},t)}await(0,At.vt)(n,(t=>t.plus(o)))}};if(i){const[t,s]=await Promise.all([Dn(e,a,n),r?In(e,a):null]),o=t?.toString()??"0",d=i.tokenType===b.iv.Asset&&"priceUSD"in i&&i.priceUSD?new Ie.Z(o).div(new Ie.Z(10).pow(i.decimals)).times(i.priceUSD).toNumber():i.balanceUSD,u=i.status===b.YF.Enabled&&new Ie.Z(i.rawBalance).gt(0)&&new Ie.Z(o).isZero();return void await c({...On(i,s),status:i.status===b.YF.Disabled&&t?b.YF.Enabled:u&&i.tokenType===b.iv.NFT?b.YF.Disabled:i.status,rawBalance:o,balanceUSD:d},i.balanceUSD)}if(s===b.Yn.Native)return;let u,l;if(s===b.Yn.ERC20){const t=(await $e([o]))[o];u=t?.usd?.toString(),l=t?.usd_24h_change?.toString()}const[p,h]=await Promise.all([In(e,a,!0),Dn(e,a,n)]);if(!p)return;if(s===b.Yn.ERC20){const t=await Fe.j.get("/cmc/v2/cryptocurrency/info",{params:{address:o}}).catch((()=>null)),e=t?.data?.data;if(e){const t=e[Object.keys(e)[0]];t?.logo&&Object.assign(p,{logoUrl:t.logo})}}const y=h?.toString()??"0",m=u&&"decimals"in p?new Ie.Z(y).div(new Ie.Z(10).pow(Number(p.decimals))).times(u).toNumber():0,g=s===b.Yn.ERC20||"decimals"in p&&p.decimals>0?b.iv.Asset:b.iv.NFT,w=g===b.iv.Asset||h?b.YF.Enabled:b.YF.Disabled,f={tokenType:g,status:w,chainId:e,accountAddress:n,tokenSlug:a,...p,rawBalance:y,balanceUSD:m,priceUSD:u,priceUSDChange:l};await c(f)}(r,t,e,n,a)}catch(t){}Wn.delete(r),setTimeout((()=>M(e)),500)}}function On(t,e){if(!e)return t;const n={...t};for(const t of Object.keys(e)){const a=e[t];(a||0n===a)&&(n[t]=a)}return n}const Vn=async(t,e)=>{try{const{standard:n,address:a}=(0,en.Sz)(e);if(n===b.Yn.Native){const[e,n]=await Promise.all([Xe(),Gn(t)]),{type:a,nativeCurrency:r}=n,s=e["testnet"!==a&&"ETH"===r.symbol?1:t];if(s)return`https://www.coingecko.com/en/coins/${s.native_coin_id}`}else if(n===b.Yn.ERC20){const t=await Je(),e=a.toLowerCase();return t[e]?`https://www.coingecko.com/en/coins/${t[e]}`:`https://dexscreener.com/search?q=${e}`}}catch(t){}return null},Gn=(0,Lt.ZP)(At.Hy);async function $n(t,e,n){let a;setTimeout((()=>{a||E(e),a=Date.now()}),300);try{await Qe(),await function(t,e){return tn.has(t)||tn.set(t,(0,h.j)()),tn.get(t)(e)}(e,(async()=>{const a=await async function(t){const e=await d.hI.where("[accountAddress+tokenSlug]").equals([t,en.mg]).first();return Boolean(e)}(e),r=await Ln(e,t);await function(t,e,n){return(t===b.iv.Asset?Mn:Hn)(e,n)}(n,t,e),n===b.iv.Asset&&await Kn(t,e),a&&r&&r!==t&&await S.t.put(b.Kj,r)}))}catch(t){}finally{a?setTimeout((()=>M(e)),Math.max(0,a+1e3-Date.now())):a=1}}var qn=n(58331);const zn=.75,Jn=.72,Xn=.92,Qn=.79,ta=.88,ea=1e9,{FALLING:na,MEDIAN_SLOPE:aa,RAISING:ra,SURGING:sa}={FALLING:.725,MEDIAN_SLOPE:-5,RAISING:1.275,SURGING:1.5},oa=(t,e)=>new Ie.Z(t).times(e),ia=(t,e)=>t||e?new Ie.Z(t).dividedBy(e):new Ie.Z(0),ca=t=>oa(t,ea).toFixed(0),da=t=>ia(t,ea).toNumber(),ua=(t,e,n)=>t<=e?0:t>=n?1:(1-Math.cos(2*(t-e)*Math.PI/(n-e)))/2,la=(t,e,n,a,r)=>{if(n<1e-6)return t[t.length-1];const s=(1-Math.exp(-1/n))/(1-Math.exp(-t.length/n));let o=0,i=0,c=0;for(const d of e){o+=s*Math.exp((d-t.length+1)/n);const e=ua(o,a,r);if(i+=(e-c)*t[d],e>=1)return i;c=e}return i},pa=(t,e,n)=>t.filter(((t,n)=>!e.includes(n))).map((t=>da(t[n]))),ha=(t,e)=>{const n=((t,e)=>{const n=[];for(let a=0;a<t.length;a+=e)n.push(t.slice(a,a+e));return n})(t,e),a=n.map((t=>(t=>{const e=t.sort(((t,e)=>t-e)),n=e[0];return{max:e[e.length-1],median:e[Math.floor(e.length/2)],min:n}})(t))),{max:r,min:s,median:o}=a[a.length-1],i=(t=>{const e=Array.from(Array(t.length+1).keys()),n=t.length;let a=0,r=0,s=0,o=0;for(let n=0;n<t.length;n++){const i=Number(t[n]),c=Number(e[n]);a+=c,r+=i,s+=c*i,o+=c*c}return(n*s-a*r)/(n*o-a*a)})(a.map((t=>t.median)));return{max:r,median:o,medianSlope:i,min:s}},ya=async(t,e="latest",n=100)=>{const a=await t.send("eth_feeHistory",[st.Ou(Ue.m9(n)),e,[]]),r=(s=a?.baseFeePerGas[a?.baseFeePerGas.length-1],new Ie.Z(s).toString());var s;const o=[],i=[];for(let t=0;t<a.baseFeePerGas.length;t++)o.push(da(a.baseFeePerGas[t])),i.push(t);const c=((t,e)=>{let n=0;try{const a=t.slice(51),r={g5:ha(a,5)},s=t.slice(1),o={g25:ha(s,25)},i=o.g25.max/o.g25.median,c=o.g25.min/o.g25.median;n=i>sa?2:i>ra&&c>na?1:i<ra&&c>na?r.g5.medianSlope<aa?-1:0:i<ra&&c<na?-1:da(e)>o.g25.median?1:-1}catch(t){}return n})(o,r);o[o.length-1]*=9/8;for(let t=a.gasUsedRatio.length-1;t>=0;t--)a.gasUsedRatio[t]>.9&&(o[t]=o[t+1]);i.sort(((t,e)=>{const n=o[t],a=o[e];return n<a?-1:n>a?1:0}));const d=[];let u=0;for(let t=15;t>=0;t--){let e=la(o,i,t,.1,.3);e>u?u=e:e=u,d[t]=e}const l=ca(oa(Math.max(...d),1.05));return{baseFeeSuggestion:l,baseFeeTrend:c,blocksToConfirmationByBaseFee:{120:oa(l,zn).toFixed(0),240:oa(l,Jn).toFixed(0),4:oa(l,Xn).toFixed(0),40:oa(l,Qn).toFixed(0),8:oa(l,ta).toFixed(0)},currentBaseFee:r}},ma=async(t,e="latest")=>{const n=(await t.send("eth_feeHistory",[st.Ou(Ue.m9(10)),e,[10,15,30,45]])).reward;if(!n.length)throw new Error("Error: block reward was empty");const a=((t,e)=>{const n=[];return t.map((t=>da(t[e]))).forEach(((t,e)=>{t>5&&n.push(e)})),n})(n,0),r=pa(n,a,0),s=pa(n,a,1),o=pa(n,a,2),i=pa(n,a,3),c=(0,qn.$5)(r,r.length)[r.length-1],d=(0,qn.$5)(s,s.length)[s.length-1],u=(0,qn.$5)(o,o.length)[o.length-1],l=(0,qn.$5)(i,i.length)[i.length-1];if(void 0===c||void 0===d||void 0===u||void 0===l)throw new Error("Error: ema was undefined");const p=Math.min(Math.max(d,1),1.8),h=Math.min(Math.max(u,1.5),3),y=Math.min(Math.max(l,2),9);return{blocksToConfirmationByPriorityFee:{1:ca(l),2:ca(u),3:ca(d),4:ca(c)},confirmationTimeByPriorityFee:{15:ca(l),30:ca(u),45:ca(d),60:ca(c)},maxPriorityFeeSuggestions:{fast:ca(h),normal:ca(p),urgent:ca(y)}}},ga=[42161,324];const wa=(0,Lt.ZP)((async t=>{try{return"bigint"===typeof(await gn()((()=>t.getFeeData()),{retries:2,minTimeout:0,maxTimeout:0})).maxPriorityFeePerGas}catch(t){return null}}),{cacheKey:([t])=>t.chainId});const fa=new Map([[137,"https://gasstation.polygon.technology/v2"],[80001,"https://gasstation-testnet.polygon.technology/v2"]]);function va(t){return new Ie.Z(t).times(10**9).integerValue().toString()}const Sa=[async function(t){const e=fa.get(t);if(!e)return null;const n=await a.Z.get(e,{timeout:6e4}),{safeLow:r,standard:s,fast:o}=n.data,[i,c,d]=[r,s,o].map((({maxFee:t,maxPriorityFee:e})=>({max:va(t),priority:va(e)})));return{type:"modern",modes:{low:i,average:c,high:d}}},async function(t){if(ga.includes(t))return null;const e=Vt(t);if(!await wa(e))return null;const n=await(async t=>{const{baseFeeSuggestion:e,baseFeeTrend:n,currentBaseFee:a,blocksToConfirmationByBaseFee:r}=await ya(t),{maxPriorityFeeSuggestions:s,confirmationTimeByPriorityFee:o,blocksToConfirmationByPriorityFee:i}=await ma(t);return{baseFeeSuggestion:e,baseFeeTrend:n,blocksToConfirmationByBaseFee:r,blocksToConfirmationByPriorityFee:i,confirmationTimeByPriorityFee:o,currentBaseFee:a,maxPriorityFeeSuggestions:s}})(e).catch((t=>null));if(!n)return null;const{baseFeeSuggestion:a,blocksToConfirmationByBaseFee:r,maxPriorityFeeSuggestions:s}=n,o=BigInt(r[8]),i=BigInt(a),c=21n*i/20n,d=BigInt(s.normal),u=BigInt(s.fast),l=BigInt(s.urgent);return{type:"modern",modes:{low:{max:(o+d).toString(),priority:d.toString()},average:{max:(i+u).toString(),priority:u.toString()},high:{max:(c+l).toString(),priority:l.toString()}}}},async function(t){const e=await Le(t);if(!e)return null;const n=await Fe.j.get("/d/v1/wallet/gas_market",{params:{chain_id:e.id}}).catch((()=>null)),a=n?.data?.data;if(!a)return null;const{slow:r,normal:s,fast:o}=a,[i,c,d]=[r,s,o].map((t=>({max:new Ie.Z(t.price).toString()})));return{type:"legacy",modes:{low:i,average:c,high:d}}},async function(t){const e=Vt(t),{gasPrice:n}=await gn()((()=>e.getFeeData()),{retries:2,minTimeout:0,maxTimeout:0});if(!n)return null;const a=10n**(n<10n**9n?7n:8n);return{type:"legacy",modes:{low:{max:(n-a).toString()},average:{max:n.toString()},high:{max:(n+a).toString()}}}}],ba=(0,Lt.ZP)((async t=>{for(const e of Sa)try{const n=await e(t);if(n)return n}catch(t){}return null}),{maxAge:5e3}),Aa="0x0000000000000000000000000000000000000000",ka=a.Z.create({baseURL:"https://api.transak.com/api/v2",timeout:9e4}),Ua=(0,Lt.ZP)((async()=>{const t=await Ta(),e=Object.values(t).filter((t=>t.slug!==en.mg)).map((t=>(0,en.Sz)(t.slug).address)),n=await $e(e),a={};for(const[e,r]of Object.entries(t))if(r.slug===en.mg){const t=await qe(+r.chainId);a[e]={...r,priceUsd:t?.usd,priceUsdChange:t?.usd_24h_change}}else{const t=n[(0,en.Sz)(r.slug).address];a[e]={...r,priceUsd:t?.usd,priceUsdChange:t?.usd_24h_change}}return a}),{maxAge:18e4}),Ta=(0,De.H)((async()=>{const t={},{data:{response:e}}=await ka.get("/currencies/crypto-currencies");for(const{network:n,uniqueId:a,address:r,image:s,symbol:o,name:i}of e){if(!r&&!n.chainId||r!==Aa&&!n.chainId)continue;const e=r!==Aa&&r?(0,en.Hb)((0,it.K)(r)):en.mg;t[`${n.chainId}_${e}`]={id:a,name:i,slug:e,chainId:n.chainId,network:n.name,image:s.large,symbol:o}}return t}),{key:"onramp_tokens",hotMaxAge:5e3,coldMaxAge:864e5});const _a=(0,h.j)();async function xa(t){try{await Et(),await(0,p.EQ)(t.data).with({type:b.Cs.GetWalletState},(async({type:e})=>{const[n,a]=L.getState();t.reply({type:e,status:n,hasSeedPhrase:a})})).with({type:b.Cs.SetupWallet},(({type:e,password:n,accountsParams:a,seedPhrase:r})=>_a((()=>Mt([b.PR.Welcome,b.PR.Locked],(async()=>{const s=await Dt.setup(n,a,r),o=s.getAccounts(),i=s.isSeedPhraseExists();U({vault:s,accounts:o,hasSeedPhrase:i}),t.reply({type:e})})))))).with({type:b.Cs.UnlockWallet},(({type:e,password:n})=>_a((()=>Mt(b.PR.Locked,(async()=>{const a=await Dt.unlock(n),r=a.getAccounts(),s=a.isSeedPhraseExists();U({vault:a,accounts:r,hasSeedPhrase:s}),t.reply({type:e})})))))).with({type:b.Cs.LockWallet},(({type:e})=>{T(),t.reply({type:e})})).with({type:b.Cs.ChangePassword},(({type:e,currentPassword:n,nextPassword:a})=>_a((()=>Ft((async r=>{await r.changePassword(n,a),t.reply({type:e})})))))).with({type:b.Cs.GetAccounts},(({type:e})=>Ft((async n=>{const a=n.getAccounts();t.reply({type:e,accounts:a})})))).with({type:b.Cs.AddAccounts},(({type:e,accountsParams:n,seedPhrase:a})=>_a((()=>Ft((async r=>{await r.addAccounts(n,a);const s=r.getAccounts();x(s),a&&_(),t.reply({type:e})})))))).with({type:b.Cs.DeleteAccounts},(({type:e,password:n,accountUuids:a})=>_a((()=>Ft((async r=>{await r.deleteAccounts(n,a);const s=r.getAccounts();x(s),t.reply({type:e})})))))).with({type:b.Cs.UpdateAccountName},(({type:e,accountUuid:n,name:a})=>_a((()=>Ft((async r=>{await r.updateAccountName(n,a);const s=r.getAccounts();x(s),t.reply({type:e})})))))).with({type:b.Cs.GetSeedPhrase},(({type:e,password:n})=>_a((()=>Ft((async a=>{const r=await a.getSeedPhrase(n);t.reply({type:e,seedPhrase:r})})))))).with({type:b.Cs.GetPrivateKey},(({type:e,password:n,accountUuid:a})=>_a((()=>Ft((async r=>{const s=await r.getPrivateKey(n,a);t.reply({type:e,privateKey:s})})))))).with({type:b.Cs.GetPublicKey},(({type:e,accountUuid:n})=>Ft((async a=>{const r=a.getPublicKey(n);t.reply({type:e,publicKey:r})})))).with({type:b.Cs.GetNeuterExtendedKey},(({type:e,derivationPath:n})=>Ft((async a=>{const r=a.getNeuterExtendedKey(n);t.reply({type:e,extendedKey:r})})))).with({type:b.Cs.GetApprovals},(({type:e})=>Mt(b.PR.Unlocked,(()=>{const n=Y.getState();t.reply({type:e,approvals:n})})))).with({type:b.Cs.Approve},(({type:e,approvalId:n,result:a})=>_a((()=>Ft((async r=>{await Ce(n,a,r),t.reply({type:e})})))))).with({type:b.Cs.RejectAllApprovals},(()=>Mt(b.PR.Unlocked,(()=>{D(null)})))).with({type:b.Cs.Sync},(({chainId:t,accountAddress:e,tokenType:n})=>Mt(b.PR.Unlocked,(()=>{$n(t,e,n)})))).with({type:b.Cs.FindToken},(({chainId:t,accountAddress:e,tokenSlug:n,refreshMetadata:a})=>Mt(b.PR.Unlocked,(()=>{Yn(t,e,n,a)})))).with({type:b.Cs.SyncTokenActivities},(({chainId:t,accountAddress:e,tokenSlug:n})=>Mt(b.PR.Unlocked,(()=>{hn(t,e,n)})))).with({type:b.Cs.GetGasPrices},(({type:e,chainId:n})=>Mt(b.PR.Unlocked,(async()=>{const a=await ba(n);t.reply({type:e,gasPrices:a})})))).with({type:b.Cs.GetOnRampCurrencies},(({type:e})=>Mt(b.PR.Unlocked,(async()=>{const n=await Ua().catch((()=>({})));t.reply({type:e,currencies:n})})))).with({type:b.Cs.GetTokenDetailsUrl},(({type:e,chainId:n,tokenSlug:a})=>Mt(b.PR.Unlocked,(async()=>{const r=await Vn(n,a).catch((()=>null));t.reply({type:e,detailsUrl:r})})))).with({type:b.Cs.GetSyncStatus},(({type:e})=>Mt(b.PR.Unlocked,(()=>{const n=W.getState();t.reply({type:e,status:n})})))).with({type:b.Cs.SendRpc},(({chainId:e,method:n,params:a,source:r})=>{me(t,r??Pa,e,n,a)})).otherwise((()=>{throw new Error("Not Found")}))}catch(e){t.replyError(e)}}const Pa={type:"self",kind:b._g.Unknown};var Ca=n(49520),Ia=n(76722),Da=n(12766),Ra=n.n(Da),Ea=n(12872);const Ma="https://wigwam.app",Fa=Ma&&new URL(Ma).host,Na={...Ea,fuzzylist:[...Ea.fuzzylist,Fa],whitelist:[...Ea.whitelist,Fa]},Ka=(0,Lt.ZP)((t=>{const e=Ba().check(t);return e.result&&"blacklist"===e.type})),Ba=(0,ut.Z)((()=>new(Ra())(Na)));var La=n(31138);const Za="wigwam_favicon";new Set([La.W.eth_sendTransaction,La.W.eth_signTransaction,La.W.eth_sign,La.W.eth_ecRecover,La.W.personal_sign,La.W.personal_ecRecover,La.W.eth_signTypedData,La.W.eth_signTypedData_v1,La.W.eth_signTypedData_v2,La.W.eth_signTypedData_v3,La.W.eth_signTypedData_v4]),new Set([La.W.eth_requestAccounts,La.W.wallet_requestPermissions,La.W.wallet_switchEthereumChain,La.W.wallet_addEthereumChain]);const Ha=new Map;async function ja(t){const{id:e,jsonrpc:n,method:a,params:r}=t.data;if(a!==Za)try{await Et();const e=t.port?.sender?.url;if(!e)throw F.Sy.rpc.resourceNotFound();const n={type:"page",url:e,tabId:t.port.sender?.tab?.id,favIconUrl:Ha.get(t.portId)||t.port.sender?.tab?.favIconUrl};me(t,n,await Ya(),a,r??[])}catch(a){t.reply({id:e,jsonrpc:n,error:F.Sy.rpc.internal()})}else Array.isArray(r)&&"string"===typeof r[0]&&Ha.set(t.portId,r[0])}const Wa=(0,Ia.d)((()=>S.t.fetch(At.pE.Web3MetaMaskCompatible).catch((()=>ve.P_))),(t=>S.t.subscribe(At.pE.Web3MetaMaskCompatible,(({newValue:e})=>t(e??ve.P_))))),Ya=(0,Ia.d)((()=>S.t.fetch(b.Kj).catch((()=>fe.H8.chainId))),Oa);function Oa(t){return S.t.subscribe(b.Kj,(({newValue:e})=>t(e??fe.H8.chainId)))}const Va=(0,Ia.d)((()=>S.t.fetch(b.hC).catch($a)),Ga);function Ga(t){return S.t.subscribe(b.hC,(({newValue:e})=>t(e??$a())))}function $a(){return O.getState()[0]}var qa=n(68722);var za=n(98515),Ja=n(4269);const Xa="https://wigwam.app";const Qa=(0,c.A2)("approve.html"),tr=(0,h.j)();let er;async function nr(){try{const t=await l().tabs.query({url:Qa});t.length>0&&await l().tabs.remove(t.map((({id:t})=>t)))}catch(t){}}const ar=()=>sr().then((t=>"mac"===t.os)),rr=()=>sr().then((t=>"win"===t.os)),sr=(0,ut.Z)((()=>l().runtime.getPlatformInfo()));async function or(t,e){const n=Date.now();try{await e()}catch(t){}finally{const a=Math.max(t-(Date.now()-n),0);setTimeout(or,a,t,e)}}const ir=(0,Lt.ZP)(((t,e)=>d.hI.get((0,en.pO)({chainId:t,accountAddress:e,tokenSlug:en.mg})).then((t=>t?.priceUSD)).catch((()=>{}))),{maxAge:18e4});function cr(t){if("error"in t)throw new Error(t.error.message);return t.result}function dr(t){return 0n===BigInt(t.status)}const ur=(0,ut.Z)((()=>l().action.setBadgeBackgroundColor({color:"#181A1F"})));const lr=t=>!["COMPLETED","CANCELLED","FAILED","REFUNDED","EXPIRED"].includes(t),pr=t=>!!["CANCELLED","FAILED"].includes(t);s.CryptoEngine.setArgon2Impl((async(t,e,n,a,r,s,i,c)=>(0,o.MD)(new Uint8Array(t),new Uint8Array(e),{t:a,p:s,m:n,version:c,dkLen:r}))),async function(){try{await l().scripting.registerContentScripts([{id:"inpage",matches:["file://*/*","http://*/*","https://*/*"],js:["scripts/inpage.js"],runAt:"document_start",allFrames:!0,world:"MAIN"}])}catch(t){}}(),(0,i.Io)(),(0,c.Uj)(),(0,d.Uo)(),function(){const t=new f(b.Kx.Wallet);t.onConnection((()=>{P(t.portsCount)})),t.onMessage(xa),L.watch((([e,n])=>{t.broadcast({type:b.Cs.WalletStateUpdated,status:e,hasSeedPhrase:n})})),x.watch((e=>{t.broadcast({type:b.Cs.AccountsUpdated,accounts:e})})),Z.watch((({prev:t,current:e})=>{t&&t.length!==e.length&&S.t.put(b.hC,t.length<e.length?e[t.length].address:e[0].address).catch(console.error)})),Y.watch((e=>{t.broadcast({type:b.Cs.ApprovalsUpdated,approvals:e})})),W.watch((e=>{t.broadcast({type:b.Cs.SyncStatusUpdated,status:e})}))}(),function(){const t=new f(b.Kx.Page);t.onMessage(ja);const e=new Map,n=new Map;t.onConnection((async(a,s)=>{if(!s.sender?.url)return;const{origin:o,hostname:i}=new URL(s.sender.url);if(o)if(async function(t,e){const n=Ka(t);n&&e()}(i,(()=>{t.notify(s,{jsonrpc:"2.0",method:"wigwam_phishing_warning"})})),await Et(),"connect"===a){let t=await d.mk.get(o);r(s,t);const a=(0,Ca.Y1)((()=>d.mk.get(o))).subscribe((e=>{t=e,r(s,e)}));e.set(s,a),n.set(s,(e=>{const n=t;switch(e){case"walletStatus":r(s,n),async function(t){if(!(Nt()&&t&&t.accountAddresses.length>0))return;try{for(const e of Y.getState())if(e.type===b.T8.Connection&&(0,N.o)(e.source)===t.origin){const n=e.returnSelectedAccount?t.accountAddresses:[(0,N.H)(t)];e.rpcCtx?.reply({result:n}),I(e.id)}}catch(t){}}(n);break;case"chainId":n||r(s);break;case"accountAddress":n&&r(s,n)}}))}else{const t=e.get(s);t&&(t.unsubscribe(),e.delete(s)),n.delete(s)}}));const a=t=>{for(const e of n.values())e(t)};K.watch((()=>a("walletStatus"))),Oa((()=>a("chainId"))),Ga((()=>a("accountAddress")));const r=async(e,n)=>{let a;const r=await Wa();if(Nt()&&n){const t=await Va();let e;e=n.accountAddresses.includes(t)?t:null,a={chainId:n.chainId,accountAddress:e?.toLowerCase(),mmCompatible:r}}else a={chainId:n?.chainId??await Ya(),accountAddress:null,mmCompatible:r};t.notify(e,{jsonrpc:"2.0",method:"wigwam_state",params:a})}}(),function(){nr();let t=null;l().runtime.onMessage.addListener((t=>{if("__OPEN_APPROVE_WINDOW"===t){e();const t=Y.getState()[0];t&&n(t)}})),C.watch((()=>e())),Y.watch((e=>{0===e.length?"window"===t?.type?l().windows.remove(t.id).catch(console.error):"tab"===t?.type&&(l().tabs.remove(t.id).catch(console.error),er&&chrome.tabs.update(Number(er),{active:!0})):t&&n(e[0])}));const e=()=>tr((async()=>{if(0!==Y.getState().length)try{"window"===t?.type?await l().windows.update(t.id,{focused:!0}).catch(console.error):"tab"===t?.type?await l().tabs.update(t.id,{active:!0}).catch(console.error):(await nr(),t=await async function(t){let e,n=440,a=660;await rr()&&(n+=13,a+=17);let r=0,s=0;try{e=await l().windows.getLastFocused(),"top-right"===t?(r=e.left+(e.width-n)-16,s=e.top+16):(r=Math.round(e.left+e.width/2-n/2),s=Math.round(e.top+e.height/2-a/2))}catch{const{screenX:t,screenY:e,outerWidth:o,outerHeight:i}=window;r=Math.round(t+o/2-n/2),s=Math.round(e+i/2-a/2)}if("fullscreen"===e?.state&&await ar()){const t=await l().tabs.query({active:!0,currentWindow:!0});er=t[0].id;return{type:"tab",id:(await l().tabs.create({url:(0,c.A2)("approve.html"),active:!0})).id}}const o=await l().windows.create({type:"popup",url:(0,c.A2)("approve.html"),width:n,height:a,top:Math.max(s,20),left:Math.max(r,20)});o.id&&o.left!==r&&"fullscreen"!==o.state&&await l().windows.update(o.id,{left:r,top:s});return{type:"window",id:o.id}}("top-right"))}catch(t){}})),n=e=>{"tab"!==t?.type&&("page"===e.source.type?e.source.tabId&&l().tabs.update(e.source.tabId,{active:!0}).catch(console.error):(0,c.Ch)())},a=()=>{t=null;const e=[];let n=0;for(const t of Y.getState())0!==n&&t.type===b.T8.Transaction||e.push(t.id),n++;D(e)};l().windows.onRemoved.addListener((e=>{"window"===t?.type&&e===t.id&&a()})),l().tabs.onRemoved.addListener((e=>{"tab"===t?.type&&e===t.id&&a()}))}(),R.watch((async()=>{const t=Y.getState();0!==t.length?await J(b.MV,t.map((t=>({...t,rpcCtx:t.rpcCtx?.serialize()})))):await Q(b.MV)})),async function(){or(5e3,(async()=>{if(!Nt())return;const t=await d.tS.where("[type+pending]").equals([b.T8.Transaction,1]).toArray();if(0===t.length)return;const e=O.getState(),n=new Map,a=new Set;await Promise.all(t.map((async r=>{if(r.type===b.T8.Transaction)try{const s=await gn()((()=>Ot(r.chainId,"eth_getTransactionReceipt",[r.txHash]).then(cr)),{retries:3,maxTimeout:1e3}),o={...r,result:s};if(s&&s.blockNumber){o.timeAt=Date.now(),o.gasTokenPriceUSD=await ir(r.chainId,r.accountAddress),a.add(r.txHash);const n=function(t,e){const n=[];for(const a of e)if(a.txHash!==t.txHash&&a.chainId===t.chainId&&a.accountAddress==t.accountAddress){const{nonce:e}=ke.Y.from(t.rawTx),{nonce:r}=ke.Y.from(a.rawTx);e>=r&&n.push(a.txHash)}return n}(r,t);for(const t of n)a.add(t);if(!dr(s))try{const t=await(0,be.as)(Vt(r.chainId),s.logs);for(const n of t)for(const t of[n.to,n.from]){const a=(0,it.K)(t);e.includes(a)&&Yn(r.chainId,a,n.tokenSlug)}}catch(t){}Yn(r.chainId,r.accountAddress,en.mg);const i=s.to&&(0,it.K)(s.to);i&&e.includes(i)&&Yn(r.chainId,i,en.mg)}n.set(r.txHash,o)}catch(t){}})));for(const t of a)n.has(t)&&(n.get(t).pending=0);await d.tS.bulkPut(Array.from(n.values())),await Promise.all(Array.from(a).map((async t=>{try{const e=n.get(t),a=d.ru.where({txHash:t,pending:1});return await(function(t){return!t.result||dr(t.result)}(e)?a.delete():a.modify((t=>{t.pending=0})))}catch{return}})))}))}(),async function(){or(5e3,(async()=>{if(!Nt())return;const t=await d.tS.where("[type+pending]").equals([b.T8.Ramp,1]).toArray(),e=[];0!==t.length&&(await Promise.all(t.map((async t=>{if(t.type===b.T8.Ramp)try{const{data:n,status:a}=await gn()((()=>Fe.j.get(`/transak/order/${t.partnerOrderId}/status`,{params:{staging:!1}})),{retries:3,maxTimeout:1e3});if(n&&200===a){const a={id:t.id,status:n.status,statusReason:n.statusReason,transactionHash:n.transactionHash,pending:lr(n.status)?1:0,withError:pr(n.status)};e.push(a)}}catch(t){}}))),e.length>0&&await Promise.all(e.map((async t=>await d.tS.update(t.id,t)))))}))}(),async function(){l().action.setBadgeText({text:""}).catch(console.warn),Y.watch((async t=>{try{await ur(),await l().action.setBadgeText({text:t.length>0?`+${t.length}`:""})}catch(t){}}))}(),l().runtime.onInstalled.addListener((({reason:t})=>{"install"===t&&l().tabs.create({url:(0,c.Mx)(),active:!0}),Xa&&["install","update"].includes(t)&&l().tabs.query({url:`${Xa}/**`}).then((t=>{const e=t[0]?.id;if(e)return l().tabs.reload(e)})).catch(console.error)})),l().runtime.onMessage.addListener((t=>{"__OPEN_OR_FOCUS_TAB"===t?.type&&(0,c.Ch)().catch(console.error)})),l().runtime.requestUpdateCheck().catch(console.error),l().runtime.onUpdateAvailable?.addListener((({version:t})=>{za.T.put(Ja.kq,t).catch(console.error)})),function(){let t;T.watch((()=>clearTimeout(t))),P.watch((async e=>{if(clearTimeout(t),0===e){const e=await(0,nt.s)();0!==e&&(t=setTimeout(T,e))}}))}(),function(){const t=(0,h.j)();let e=0;Dt.onPasswordUsage=n=>t((async()=>{e=Math.max(e,await async function(){return await $.fetchForce(nt.p.PasswordUsageAttempts)??0}()),n?e=0:(e++,e>4&&(await new Promise((t=>setTimeout(t,(0,qa.X)(2e3,3e3)))),K.getState()!==b.PR.Locked&&T(),e>ve.eD&&(await S.t.put(nt.p.ProfileBlockedUntil,Date.now()+ve.yO),e=0)));const t=e>0?$.put(nt.p.PasswordUsageAttempts,e):$.remove(nt.p.PasswordUsageAttempts);await t.catch(console.error)})),Dt.ensureNotBlocked=async()=>{const t=await S.t.fetchForce(nt.p.ProfileBlockedUntil);if(t&&t>Date.now())throw new Error("Profile blocked")}}(),S.t.subscribe(At.pE.TestNetworks,(async({newValue:t})=>{if(!1===t){const[t,e]=await Promise.all([S.t.fetchForce(b.Kj),S.t.fetch(b.hC).catch((()=>O.getState()[0]))]);if(t&&"mainnet"!==(await(0,At.Hy)(t)).type){let t;const n=await d.hI.where("[accountAddress+tokenSlug]").equals([e,At.mg]).toArray();for(const e of n){if(!e.portfolioUSD)continue;const n=new Ie.Z(e.portfolioUSD);n.isZero()||t&&!n.isGreaterThan(e.portfolioUSD)||(t=e)}S.t.put(b.Kj,(t??fe.H8).chainId)}}}))},26389:(t,e,n)=>{"use strict";n.d(e,{v:()=>i});var a=n(5556),r=n(54773),s=n(85350),o=n(53166);async function i(t,e,n){if(e===o.mg)return await t.getBalance(n);{const{standard:i,address:c,id:d}=(0,o.Sz)(e);switch(i){case s.Yn.ERC20:{const e=r.w6.connect(c,t);return await e.balanceOf(n)}case s.Yn.ERC721:{const e=r.aC.connect(c,t),s=await e.ownerOf(d);return a.K(s)===n?1n:0n}case s.Yn.ERC1155:{const e=r.bP.connect(c,t);return await e.balanceOf(n,d)}default:throw new Error("Unhandled Token ERC standard")}}}},96934:(t,e,n)=>{"use strict";n.d(e,{as:()=>l,m9:()=>u});var a=n(79554),r=n(5556),s=n(11126),o=n(98964),i=n(54773),c=n(85350),d=n(53166);async function u(t,e){if(!e.to)return w(e.data)?null:{type:c.UY.ContractDeployment};const n=g(e.to);if(w(e.data))return{type:c.UY.TokenTransfer,toAddress:n,tokens:[{slug:d.mg,amount:g(e.value??0)}]};const a=()=>({type:c.UY.ContractInteraction,contractAddress:n,nativeTokenAmount:e.value&&!w(e.value)?g(e.value):void 0}),r=function(t){const e=[];try{e.push([c.Yn.ERC20,p.parseTransaction({data:t})])}catch{}try{e.push([c.Yn.ERC721,h.parseTransaction({data:t})])}catch{}try{e.push([c.Yn.ERC1155,y.parseTransaction({data:t})])}catch{}return e}(e.data);if(0===r.length)return a();const s=await m(t,n,r);return(0,o.EQ)(s).with([c.Yn.ERC20,{name:"transfer"}],(([t,{args:e}])=>({type:c.UY.TokenTransfer,toAddress:g(e[0]),tokens:[{slug:(0,d.Vy)({standard:t,address:n,id:"0"}),amount:g(e[1])}]}))).with([c.Yn.ERC20,{name:"approve"}],(([t,{args:e}])=>({type:c.UY.TokenApprove,toAddress:g(e[0]),tokenSlug:(0,d.Vy)({standard:t,address:n,id:"0"}),amount:g(e[1]),clears:w(e[1])}))).with([c.Yn.ERC20,{name:"transferFrom"}],(([t,{args:e}])=>({type:c.UY.TokenTransfer,toAddress:g(e[1]),tokens:[{slug:(0,d.Vy)({standard:t,address:n,id:"0"}),amount:g(e[2])}],fromAddress:g(e[0])}))).with([c.Yn.ERC721,{name:"safeTransferFrom"}],(([t,{args:e}])=>({type:c.UY.TokenTransfer,toAddress:g(e[1]),tokens:[{slug:(0,d.Vy)({standard:t,address:n,id:g(e[2])}),amount:"1"}],fromAddress:g(e[0])}))).with([c.Yn.ERC721,{name:"transferFrom"}],(([t,{args:e}])=>({type:c.UY.TokenTransfer,toAddress:g(e[1]),tokens:[{slug:(0,d.Vy)({standard:t,address:n,id:g(e[2])}),amount:"1"}],fromAddress:g(e[0])}))).with([c.Yn.ERC721,{name:"approve"}],(([t,{args:e}])=>({type:c.UY.TokenApprove,toAddress:g(e[0]),tokenSlug:(0,d.Vy)({standard:t,address:n,id:g(e[1])}),clears:w(e[0])}))).with([c.Yn.ERC721,{name:"setApprovalForAll",args:o.P.select()}],(t=>({type:c.UY.TokenApprove,toAddress:g(t[0]),clears:Boolean(t[1]),allTokensContract:e.to}))).with([c.Yn.ERC1155,{name:"setApprovalForAll",args:o.P.select()}],(t=>({type:c.UY.TokenApprove,toAddress:g(t[0]),clears:Boolean(t[1]),allTokensContract:e.to}))).with([c.Yn.ERC1155,{name:"safeTransferFrom"}],(([t,{args:e}])=>({type:c.UY.TokenTransfer,toAddress:g(e[1]),tokens:[{slug:(0,d.Vy)({standard:t,address:n,id:g(e[2])}),amount:g(e[3])}],fromAddress:g(e[0]),data:w(e[4])?void 0:g(e[4])}))).with([c.Yn.ERC1155,{name:"safeBatchTransferFrom"}],(([t,{args:e}])=>({type:c.UY.TokenTransfer,toAddress:g(e[1]),tokens:e[2].map(((a,r)=>({slug:(0,d.Vy)({standard:t,address:n,id:g(a)}),amount:g(e[3][r])}))),fromAddress:g(e[0]),data:w(e[4])?void 0:g(e[4])}))).otherwise(a)}async function l(t,e){const n=[];return await Promise.all(e.map((async e=>{const a=function(t){const e=[];try{e.push([c.Yn.ERC20,p.parseLog(t)])}catch{}try{e.push([c.Yn.ERC721,h.parseLog(t)])}catch{}try{e.push([c.Yn.ERC1155,y.parseLog(t)])}catch{}return e}(e);if(0===a.length)return;const r=g(e.address),s=await m(t,r,a);(0,o.EQ)(s).with([c.Yn.ERC20,{name:"Transfer"}],(([t,{args:e}])=>{n.push({tokenSlug:(0,d.Vy)({standard:t,address:r,id:"0"}),from:g(e[0]),to:g(e[1]),amount:g(e[2])})})).with([c.Yn.ERC721,{name:"Transfer"}],(([t,{args:e}])=>{n.push({tokenSlug:(0,d.Vy)({standard:t,address:r,id:g(e[2])}),from:g(e[0]),to:g(e[1]),amount:"1"})})).with([c.Yn.ERC1155,{name:"TransferSingle"}],(([t,{args:e}])=>{n.push({tokenSlug:(0,d.Vy)({standard:t,address:r,id:g(e[3])}),from:g(e[1]),to:g(e[2]),amount:g(e[4])})})).with([c.Yn.ERC1155,{name:"TransferBatch"}],(([t,{args:e}])=>{const a=e[3].length;for(let s=0;s<a;s++)n.push({tokenSlug:(0,d.Vy)({standard:t,address:r,id:g(e[3][s])}),from:g(e[1]),to:g(e[2]),amount:g(e[4][s])})})).otherwise((()=>null))}))),n}const p=i.w6.createInterface(),h=i.aC.createInterface(),y=i.bP.createInterface();async function m(t,e,n){if(n.length>1){const a=await Promise.all(n.map((([n])=>(0,d.HK)(t,e,n))));for(let t=0;t<n.length;t++){if(a[t])return n[t]}}return n[0]}function g(t){return"string"===typeof t&&a.UJ(t)?r.K(t):t.toString()}function w(t){return!(t=t?.toHexString?.()??t?.toString?.())||"0x"===t||"0x00"===t||t===s.N}},59878:(t,e,n)=>{"use strict";n.d(e,{g:()=>a});const a=[{code:"BTC",name:"Bitcoin",unit:"\u20bf"},{code:"ETH",name:"Ether",unit:"ETH"},{code:"USD",name:"US Dollar",unit:"$"},{code:"AED",name:"United Arab Emirates Dirham",unit:"DH"},{code:"ARS",name:"Argentine Peso",unit:"$"},{code:"AUD",name:"Australian Dollar",unit:"A$"},{code:"BDT",name:"Bangladeshi Taka",unit:"\u09f3"},{code:"BHD",name:"Bahraini Dinar",unit:"BD"},{code:"BMD",name:"Bermudian Dollar",unit:"$"},{code:"BRL",name:"Brazil Real",unit:"R$"},{code:"CAD",name:"Canadian Dollar",unit:"CA$"},{code:"CHF",name:"Swiss Franc",unit:"\u20a3"},{code:"CLP",name:"Chilean Peso",unit:"CLP$"},{code:"CNY",name:"Chinese Yuan",unit:"\xa5"},{code:"CZK",name:"Czech Koruna",unit:"K\u010d"},{code:"DKK",name:"Danish Krone",unit:"kr."},{code:"EUR",name:"Euro",unit:"\u20ac"},{code:"GBP",name:"British Pound Sterling",unit:"\xa3"},{code:"HKD",name:"Hong Kong Dollar",unit:"HK$"},{code:"HUF",name:"Hungarian Forint",unit:"Ft"},{code:"IDR",name:"Indonesian Rupiah",unit:"Rp"},{code:"ILS",name:"Israeli New Shekel",unit:"\u20aa"},{code:"INR",name:"Indian Rupee",unit:"\u20b9"},{code:"JPY",name:"Japanese Yen",unit:"\xa5"},{code:"KRW",name:"South Korean Won",unit:"\u20a9"},{code:"KWD",name:"Kuwaiti Dinar",unit:"KD"},{code:"LKR",name:"Sri Lankan Rupee",unit:"Rs"},{code:"MMK",name:"Burmese Kyat",unit:"K"},{code:"MXN",name:"Mexican Peso",unit:"MX$"},{code:"MYR",name:"Malaysian Ringgit",unit:"RM"},{code:"NGN",name:"Nigerian Naira",unit:"\u20a6"},{code:"NOK",name:"Norwegian Krone",unit:"kr"},{code:"NZD",name:"New Zealand Dollar",unit:"NZ$"},{code:"PHP",name:"Philippine Peso",unit:"\u20b1"},{code:"PKR",name:"Pakistani Rupee",unit:"\u20a8"},{code:"PLN",name:"Polish Zloty",unit:"z\u0142"},{code:"SAR",name:"Saudi Riyal",unit:"SR"},{code:"SEK",name:"Swedish Krona",unit:"kr"},{code:"SGD",name:"Singapore Dollar",unit:"S$"},{code:"THB",name:"Thai Baht",unit:"\u0e3f"},{code:"TRY",name:"Turkish Lira",unit:"\u20ba"},{code:"TWD",name:"New Taiwan Dollar",unit:"NT$"},{code:"UAH",name:"Ukrainian hryvnia",unit:"\u20b4"},{code:"VEF",name:"Venezuelan bol\xedvar fuerte",unit:"Bs.F"},{code:"VND",name:"Vietnamese \u0111\u1ed3ng",unit:"\u20ab"},{code:"ZAR",name:"South African Rand",unit:"R"},{code:"XDR",name:"IMF Special Drawing Rights",unit:"XDR"}]},68722:(t,e,n)=>{"use strict";function a(t,e){return Math.floor(Math.random()*(e-t)+t)}n.d(e,{X:()=>a})},19170:()=>{},72260:()=>{},72895:()=>{},13121:()=>{},31865:()=>{},88924:()=>{},55024:()=>{}},t=>{t.O(0,[435,134,751,826,99,659],(()=>{return e=25343,t(t.s=e);var e}));t.O()}]);